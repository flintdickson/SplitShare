<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitShare - Track Your Strength</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Bebas+Neue&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --black: #0a0a0a;
            --white: #fafafa;
            --iron: #1a1a1a;
            --steel: #2a2a2a;
            --primary: #ff6b35;
            --primary-dark: #ff5722;
            --primary-light: #ff8c61;
            --accent: #ffb347;
            --highlight: #ffd89b;
            --sweat: #ff9966;
            --shadow: rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Oswald', sans-serif;
            background: var(--black);
            color: var(--white);
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, var(--iron) 1px, transparent 1px),
                linear-gradient(180deg, var(--iron) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            z-index: 0;
            animation: gridPulse 4s ease-in-out infinite;
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.15; }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            padding: 20px 0;
            border-bottom: 3px solid var(--primary);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header-content {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 4px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
        }

        /* Bottom Navigation Bar */
        nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--iron);
            border-top: 2px solid var(--primary);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.5);
        }

        nav a {
            color: #999;
            text-decoration: none;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            flex: 1;
            max-width: 100px;
        }

        nav a::before {
            content: attr(data-icon);
            font-size: 24px;
            transition: all 0.3s ease;
        }

        nav a:hover {
            color: var(--primary);
        }

        nav a.active {
            color: var(--primary);
        }

        nav a::after {
            display: none;
        }

        /* Center Log Button */
        .log-btn-container {
            position: relative;
            flex: 0 0 auto;
            margin: 0 10px;
        }

        .log-btn {
            background: var(--primary);
            color: var(--white);
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 4px solid var(--iron);
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            overflow: visible;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
            margin-top: -28px;
        }

        .log-btn span {
            position: relative;
            z-index: 1;
        }

        .log-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.6);
        }

        .log-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .log-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        /* Add bottom padding to main content to account for fixed nav */
        main {
            padding-bottom: 100px;
        }

        /* Hero Stats */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 30px 0;
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        @keyframes fadeInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .stat-card {
            background: linear-gradient(135deg, var(--steel), var(--iron));
            padding: 20px;
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 32px;
            color: var(--white);
            line-height: 1;
        }

        .stat-unit {
            font-size: 16px;
            color: var(--primary);
            margin-left: 5px;
        }

        /* Feed Section */
        .feed-section {
            margin: 60px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            animation: fadeInUp 1s ease-out 0.4s backwards;
        }

        .section-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .filter-tabs {
            display: flex;
            gap: 15px;
        }

        .filter-tab {
            background: transparent;
            color: #999;
            border: 2px solid #333;
            padding: 10px 25px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tab.active,
        .filter-tab:hover {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        /* Activity Cards */
        .activity-feed {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }

        .activity-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 0;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 1.2s ease-out backwards;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .activity-card:nth-child(1) { animation-delay: 0.5s; }
        .activity-card:nth-child(2) { animation-delay: 0.6s; }
        .activity-card:nth-child(3) { animation-delay: 0.7s; }
        .activity-card:nth-child(4) { animation-delay: 0.8s; }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .activity-card:hover::before {
            transform: scaleX(1);
        }

        .activity-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.2);
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid #333;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            font-weight: 700;
        }

        .activity-user-info h3 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .activity-time {
            font-size: 12px;
            color: #999;
            font-family: 'Roboto Mono', monospace;
        }

        .workout-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 22px;
            letter-spacing: 2px;
            padding: 15px 20px;
            margin: 0;
            color: var(--white);
            border-bottom: 1px solid #333;
            background: rgba(0, 0, 0, 0.2);
        }

        .workout-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 15px;
        }

        .workout-stat {
            text-align: center;
            padding: 12px;
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .workout-stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            color: var(--primary);
        }

        .workout-stat-label {
            font-size: 10px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 3px;
        }

        .exercise-list {
            padding: 0 15px 15px 15px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--iron);
            border-left: 3px solid var(--sweat);
            font-family: 'Roboto Mono', monospace;
        }

        .exercise-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--white);
        }

        .exercise-details {
            color: var(--sweat);
            font-size: 12px;
        }

        .activity-actions {
            display: flex;
            gap: 15px;
            padding: 15px 20px;
            border-top: 1px solid #333;
            margin-top: auto;
        }

        .action-btn {
            background: transparent;
            border: none;
            color: #999;
            font-family: 'Oswald', sans-serif;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            color: var(--primary);
        }

        .action-icon {
            font-size: 18px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: flex-start;
            justify-content: center;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
            padding: 20px 0 100px 0;
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--steel);
            padding: 40px;
            width: 90%;
            max-width: 700px;
            border: 2px solid var(--primary);
            position: relative;
            animation: slideUp 0.4s ease-out;
            margin: auto;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 30px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .modal h2 {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 3px;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            color: #ccc;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            background: var(--iron);
            border: 2px solid #333;
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .exercise-inputs {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .add-exercise-btn {
            background: transparent;
            color: var(--sweat);
            border: 2px dashed var(--sweat);
            padding: 12px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-exercise-btn:hover {
            background: var(--sweat);
            color: var(--black);
        }

        .submit-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 18px 50px;
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.02);
        }

        /* Photo Upload Styling */
        .photo-upload-zone {
            border: 2px dashed rgba(255, 107, 53, 0.3);
            padding: 30px;
            text-align: center;
            background: rgba(255, 107, 53, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .photo-upload-zone:hover {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .photo-upload-zone.has-image {
            padding: 0;
            border-style: solid;
        }

        .upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .upload-text {
            color: #999;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #photoInput {
            display: none;
        }

        .preview-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            display: none;
        }

        .preview-image.active {
            display: block;
        }

        .remove-photo {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            color: var(--white);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .remove-photo.active {
            display: flex;
        }

        .remove-photo:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* Workout Photo in Activity Cards */
        .workout-photo {
            width: 100%;
            height: 300px;
            object-fit: cover;
            margin: 0;
            border: none;
        }

        .workout-caption {
            font-size: 15px;
            line-height: 1.6;
            color: #fff;
            padding: 15px 20px;
            font-style: normal;
            font-weight: 400;
        }

        /* Workout Details Section */
        .workout-details {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.2);
        }
        }

        .details-toggle {
            background: transparent;
            border: none;
            color: var(--primary);
            font-family: 'Oswald', sans-serif;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }

        .details-toggle:hover {
            color: var(--primary-light);
        }

        .details-toggle-icon {
            transition: transform 0.3s ease;
            font-size: 10px;
        }

        .details-toggle.active .details-toggle-icon {
            transform: rotate(180deg);
        }

        .workout-details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .workout-details-content.active {
            max-height: 1000px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .workout-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .activity-feed {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 32px;
            }

            nav a {
                font-size: 10px;
                padding: 5px 8px;
                max-width: 80px;
            }

            nav a::before {
                font-size: 20px;
            }

            .log-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                margin-top: -25px;
            }

            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 28px;
            }
            
            .activity-feed {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }

            .workout-stats {
                grid-template-columns: 1fr;
            }

            .exercise-inputs {
                grid-template-columns: 1fr;
            }
        }

        /* Progress Page Styles */
        .progress-page {
            display: none;
        }

        .progress-page.active {
            display: block;
        }

        .feed-page.active {
            display: block;
        }

        .feed-page {
            display: none;
        }

        .progress-header {
            margin: 60px 0 40px 0;
            animation: fadeInUp 0.6s ease-out;
        }

        .progress-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 48px;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .progress-subtitle {
            color: #999;
            font-size: 16px;
            letter-spacing: 1px;
        }

        .exercise-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        .exercise-btn {
            background: var(--steel);
            border: 2px solid #333;
            color: var(--white);
            padding: 20px;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .exercise-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .exercise-btn:hover::before,
        .exercise-btn.active::before {
            transform: scaleY(1);
        }

        .exercise-btn:hover,
        .exercise-btn.active {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .chart-container {
            background: var(--steel);
            border: 1px solid #333;
            padding: 40px;
            margin-bottom: 30px;
            animation: fadeInUp 1s ease-out 0.4s backwards;
        }

        .chart-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 32px;
            letter-spacing: 2px;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .chart-wrapper {
            position: relative;
            height: 450px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
        }

        .chart-canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .pr-badge {
            display: inline-block;
            background: var(--primary);
            color: var(--white);
            padding: 5px 12px;
            font-size: 12px;
            font-weight: 700;
            border-radius: 3px;
            margin-left: 10px;
            letter-spacing: 1px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .stat-box {
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
            padding: 20px;
            text-align: center;
        }

        .stat-box-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-box-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 36px;
            color: var(--primary);
        }

        .workout-history {
            margin-top: 40px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table thead {
            background: rgba(0, 0, 0, 0.3);
        }

        .history-table th {
            padding: 15px;
            text-align: left;
            font-family: 'Oswald', sans-serif;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .history-table td {
            padding: 15px;
            border-bottom: 1px solid #333;
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
        }

        .history-table tbody tr {
            transition: background 0.3s ease;
        }

        .history-table tbody tr:hover {
            background: rgba(255, 107, 53, 0.05);
        }

        .trend-up {
            color: #4ade80;
        }

        .trend-down {
            color: #f87171;
        }

        .trend-neutral {
            color: #999;
        }

        /* Groups Page Styles */
        .groups-page {
            display: none;
        }

        .groups-page.active {
            display: block;
        }

        .groups-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 60px 0 40px 0;
            animation: fadeInUp 0.6s ease-out;
        }

        .create-group-btn {
            background: var(--primary);
            color: var(--white);
            padding: 15px 35px;
            border: none;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .create-group-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .group-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .group-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .group-header-banner {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 30px;
            position: relative;
        }

        .group-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            letter-spacing: 2px;
            color: var(--white);
            margin-bottom: 5px;
        }

        .group-members-count {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            font-family: 'Roboto Mono', monospace;
        }

        .group-body {
            padding: 25px;
        }

        .group-description {
            color: #ccc;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .group-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .group-stat {
            text-align: center;
            padding: 12px;
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .group-stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            color: var(--primary);
        }

        .group-stat-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .view-group-btn {
            width: 100%;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 12px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-group-btn:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* Group Detail View */
        .group-detail {
            display: none;
        }

        .group-detail.active {
            display: block;
        }

        .group-detail-header {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 40px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out;
        }

        .back-to-groups {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease;
        }

        .back-to-groups:hover {
            color: var(--white);
        }

        .group-detail-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 48px;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .group-detail-info {
            display: flex;
            gap: 30px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .post-workout-btn {
            background: var(--white);
            color: var(--primary);
            padding: 15px 40px;
            border: none;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .post-workout-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
        }

        .group-workout-feed {
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        .group-workout-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 0;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .group-workout-card:hover {
            border-color: var(--primary);
        }

        .workout-posted-by {
            padding: 20px 30px;
            background: rgba(255, 107, 53, 0.1);
            border-bottom: 2px solid var(--primary);
        }

        .posted-by-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .posted-by-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            color: var(--primary);
        }

        .workout-challenge-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            letter-spacing: 2px;
            padding: 20px 30px 10px 30px;
        }

        .workout-challenge-description {
            padding: 0 30px 20px 30px;
            color: #ccc;
            font-size: 15px;
            line-height: 1.6;
        }

        .workout-challenge-exercises {
            padding: 0 30px 20px 30px;
        }

        .completions-section {
            padding: 25px 30px;
            background: rgba(0, 0, 0, 0.2);
            border-top: 1px solid #333;
        }

        .completions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .completions-title {
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #999;
        }

        .complete-workout-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 10px 25px;
            font-family: 'Oswald', sans-serif;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .complete-workout-btn:hover {
            background: var(--primary-dark);
        }

        .complete-workout-btn.completed {
            background: #4ade80;
        }

        .completions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .completion-item {
            background: var(--iron);
            padding: 15px;
            border-left: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .completion-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 18px;
            flex-shrink: 0;
        }

        .completion-info {
            flex: 1;
        }

        .completion-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .completion-time {
            font-size: 11px;
            color: #999;
            font-family: 'Roboto Mono', monospace;
        }

        .completion-status {
            font-size: 20px;
        }

        .completion-photo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border: 2px solid var(--primary);
            cursor: pointer;
        }

        /* Auth Pages (Login/Signup) */
        .auth-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--black);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .auth-page.active {
            display: flex;
        }

        .auth-container {
            max-width: 450px;
            width: 90%;
            animation: slideUp 0.5s ease-out;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-logo-text {
            font-family: 'Bebas Neue', cursive;
            font-size: 56px;
            letter-spacing: 4px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-tagline {
            color: #999;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 10px;
        }

        .auth-form {
            background: var(--steel);
            padding: 40px;
            border: 2px solid var(--primary);
        }

        .auth-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 32px;
            letter-spacing: 2px;
            color: var(--primary);
            margin-bottom: 30px;
        }

        .auth-input-group {
            margin-bottom: 20px;
        }

        .auth-input-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            color: #ccc;
        }

        .auth-input-group input {
            width: 100%;
            padding: 15px;
            background: var(--iron);
            border: 2px solid #333;
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .auth-input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .auth-submit-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 18px;
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .auth-submit-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .auth-switch {
            text-align: center;
            margin-top: 25px;
            color: #999;
            font-size: 14px;
        }

        .auth-switch-link {
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .auth-switch-link:hover {
            color: var(--primary-light);
        }

        /* Profile Page */
        .profile-page {
            display: none;
        }

        .profile-page.active {
            display: block;
        }

        .profile-header {
            background: linear-gradient(135deg, var(--steel), var(--iron));
            padding: 40px;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--primary);
            animation: fadeInUp 0.6s ease-out;
        }

        .profile-top {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 48px;
            border: 4px solid var(--primary);
            flex-shrink: 0;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .profile-username {
            color: var(--primary);
            font-size: 18px;
            font-family: 'Roboto Mono', monospace;
            margin-bottom: 15px;
        }

        .profile-bio {
            color: #ccc;
            line-height: 1.6;
            font-size: 15px;
            margin-bottom: 20px;
        }

        .profile-stats-row {
            display: flex;
            gap: 30px;
        }

        .profile-stat-item {
            text-align: center;
        }

        .profile-stat-number {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            color: var(--primary);
        }

        .profile-stat-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .edit-profile-btn, .logout-btn {
            padding: 12px 30px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .edit-profile-btn {
            background: var(--primary);
            color: var(--white);
        }

        .edit-profile-btn:hover {
            background: var(--primary-dark);
        }

        .logout-btn {
            background: transparent;
            border: 2px solid #666;
            color: #999;
        }

        .logout-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .profile-tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #333;
            margin-bottom: 30px;
        }

        .profile-tab {
            background: transparent;
            border: none;
            color: #999;
            padding: 15px 30px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .profile-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .profile-tab:hover {
            color: var(--primary);
        }

        .profile-content {
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        .profile-tab-content {
            display: none;
        }

        .profile-tab-content.active {
            display: block;
        }

        .profile-achievements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .achievement-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .achievement-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .achievement-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .achievement-description {
            font-size: 13px;
            color: #999;
        }

        .no-auth-message {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-auth-message h2 {
            font-family: 'Bebas Neue', cursive;
            font-size: 36px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .login-prompt-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 15px 40px;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .login-prompt-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }



    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">SPLITSHARE</div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Feed Page -->
        <div class="feed-page active">
        <section class="feed-section">

            <!-- User Search Bar -->
            <div style="position:relative; margin:25px 0 20px 0;">
                <input id="userSearchInput" type="text" placeholder="üîç  Search users by name or @username..."
                    style="width:100%;padding:16px 20px;background:var(--steel);border:2px solid #333;color:var(--white);font-family:'Oswald',sans-serif;font-size:15px;letter-spacing:0.5px;transition:border-color 0.3s;"
                    oninput="handleUserSearch(this.value)"
                    onfocus="this.style.borderColor='var(--primary)'"
                    onblur="setTimeout(()=>document.getElementById('userSearchResults').style.display='none',200)">
                <div id="userSearchResults" style="display:none;position:absolute;top:100%;left:0;right:0;background:var(--steel);border:2px solid var(--primary);border-top:none;z-index:500;max-height:320px;overflow-y:auto;"></div>
            </div>

            <div class="section-header">
                <h2 class="section-title">Activity Feed</h2>
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="switchFeedTab('following', this)">Following</button>
                    <button class="filter-tab" onclick="switchFeedTab('everyone', this)">Everyone</button>
                    <button class="filter-tab" onclick="switchFeedTab('mine', this)">My Workouts</button>
                </div>
            </div>

            <div class="activity-feed" id="mainFeed">
                <div class="feed-empty-state" id="feedEmptyState" style="display:none; text-align:center; padding:80px 20px; color:#999;">
                    <div style="font-size:64px; margin-bottom:20px;">üèãÔ∏è</div>
                    <h3 style="font-family:'Bebas Neue',cursive; font-size:32px; color:var(--primary); margin-bottom:10px; letter-spacing:2px;">NO WORKOUTS YET</h3>
                    <p style="font-size:16px; line-height:1.6;" id="feedEmptyMsg">Be the first to log a workout!<br>Hit the <strong style="color:var(--primary)">+</strong> button below to get started.</p>
                </div>
            </div>
        </section>
        </div>
        <!-- End Feed Page -->

        <!-- Progress Page -->
        <div class="progress-page">
            <div class="progress-header">
                <h1 class="progress-title">Your Lift Progress</h1>
                <p class="progress-subtitle">Built from your logged workouts</p>
            </div>

            <!-- Dynamic exercise selector ‚Äî populated from real data -->
            <div id="exerciseSelectorWrapper">
                <div id="exerciseSelector" class="exercise-selector"></div>
            </div>

            <!-- Empty state -->
            <div id="progressEmptyState" style="display:none; text-align:center; padding:80px 20px; color:#999;">
                <div style="font-size:64px; margin-bottom:20px;">üìä</div>
                <h3 style="font-family:'Bebas Neue',cursive; font-size:32px; color:var(--primary); margin-bottom:10px; letter-spacing:2px;">NO DATA YET</h3>
                <p style="font-size:16px; line-height:1.8;">Log workouts with exercises and weights<br>to see your progress charts here.</p>
            </div>

            <div id="progressChartContainer" class="chart-container" style="display:none;">
                <h2 class="chart-title" id="chartTitle">Progress</h2>
                <div class="chart-wrapper">
                    <canvas id="progressChart" class="chart-canvas"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-box-label">Current PR</div>
                        <div class="stat-box-value" id="currentPR">‚Äî</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-label">Total Increase</div>
                        <div class="stat-box-value" id="totalIncrease">‚Äî</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-label">Sessions Logged</div>
                        <div class="stat-box-value" id="sessionsLogged">‚Äî</div>
                    </div>
                </div>
            </div>

            <div id="progressHistoryContainer" class="workout-history" style="display:none;">
                <h2 class="chart-title">Exercise History</h2>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Exercise</th>
                            <th>Weight</th>
                            <th>Sets √ó Reps</th>
                            <th>Volume</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody"></tbody>
                </table>
            </div>
        </div>
        <!-- End Progress Page -->

        <!-- My Groups Page -->
        <div class="groups-page">

            <!-- VIEW: My Groups List -->
            <div id="groupsListView">
                <div class="groups-header">
                    <div>
                        <h1 class="progress-title">My Groups</h1>
                        <p class="progress-subtitle">Train together, achieve together</p>
                    </div>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <button class="create-group-btn" style="background:transparent;border:2px solid var(--primary);color:var(--primary);" onclick="showJoinGroupPanel()">üîç Find Group</button>
                        <button class="create-group-btn" onclick="showCreateGroupPanel()">+ Create Group</button>
                    </div>
                </div>

                <!-- Create Group Panel -->
                <div id="createGroupPanel" style="display:none; background:var(--steel); border:2px solid var(--primary); padding:30px; margin-bottom:30px;">
                    <h3 style="font-family:'Bebas Neue',cursive;font-size:28px;color:var(--primary);letter-spacing:2px;margin-bottom:20px;">CREATE NEW GROUP</h3>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                        <div class="form-group" style="margin:0;">
                            <label>Group Name</label>
                            <input id="newGroupName" type="text" placeholder="Morning Grind Crew">
                        </div>
                        <div class="form-group" style="margin:0;">
                            <label>Group ID (unique, no spaces)</label>
                            <input id="newGroupId" type="text" placeholder="morninggrind2026" oninput="this.value=this.value.toLowerCase().replace(/[^a-z0-9]/g,'')">
                        </div>
                    </div>
                    <div class="form-group" style="margin:15px 0;">
                        <label>Description</label>
                        <textarea id="newGroupDesc" rows="2" placeholder="What's this group about?"></textarea>
                    </div>
                    <div class="form-group" style="margin:0 0 15px 0;">
                        <label>Privacy</label>
                        <select id="newGroupPrivacy" onchange="toggleJoinCode()">
                            <option value="public">Public ‚Äî anyone can join by searching the Group ID</option>
                            <option value="private">Private ‚Äî requires a join code</option>
                        </select>
                    </div>
                    <div id="joinCodeRow" style="display:none;" class="form-group">
                        <label>Join Code (members will need this)</label>
                        <input id="newGroupCode" type="text" placeholder="e.g. LIFT2026" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()">
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button class="submit-btn" style="margin:0;padding:15px 30px;width:auto;" onclick="handleCreateGroup()">Create Group</button>
                        <button style="background:transparent;border:2px solid #555;color:#999;padding:15px 30px;font-family:'Oswald',sans-serif;font-size:14px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;" onclick="hideCreateGroupPanel()">Cancel</button>
                    </div>
                </div>

                <!-- Join Group Panel -->
                <div id="joinGroupPanel" style="display:none; background:var(--steel); border:2px solid var(--primary); padding:30px; margin-bottom:30px;">
                    <h3 style="font-family:'Bebas Neue',cursive;font-size:28px;color:var(--primary);letter-spacing:2px;margin-bottom:20px;">FIND & JOIN A GROUP</h3>
                    <div style="display:flex;gap:10px;align-items:flex-end;">
                        <div class="form-group" style="margin:0;flex:1;">
                            <label>Group ID</label>
                            <input id="searchGroupId" type="text" placeholder="Enter group ID (e.g. morninggrind2026)">
                        </div>
                        <button class="submit-btn" style="margin:0;padding:15px 30px;width:auto;" onclick="handleSearchGroup()">Search</button>
                    </div>
                    <div id="searchGroupResult" style="margin-top:20px;"></div>
                    <button style="background:transparent;border:none;color:#666;font-family:'Oswald',sans-serif;font-size:13px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;margin-top:15px;" onclick="hideJoinGroupPanel()">Cancel</button>
                </div>

                <!-- My Groups Grid -->
                <div id="myGroupsGrid" class="groups-grid">
                    <!-- Populated by JS -->
                </div>
                <div id="myGroupsEmpty" style="display:none;text-align:center;padding:80px 20px;color:#999;">
                    <div style="font-size:64px;margin-bottom:20px;">üë•</div>
                    <h3 style="font-family:'Bebas Neue',cursive;font-size:32px;color:var(--primary);margin-bottom:10px;letter-spacing:2px;">NO GROUPS YET</h3>
                    <p style="font-size:16px;line-height:1.8;">Create a group or find one by its Group ID.</p>
                </div>
            </div>

            <!-- VIEW: Group Detail -->
            <div id="groupDetailView" style="display:none;">
                <div class="group-detail-header" id="groupDetailHeader">
                    <button class="back-to-groups" onclick="closeGroupDetail()">‚Üê Back to Groups</button>
                    <h2 class="group-detail-title" id="groupDetailTitle"></h2>
                    <div class="group-detail-info" id="groupDetailInfo"></div>
                    <div id="groupDetailActions" style="margin-top:15px;display:flex;gap:10px;flex-wrap:wrap;"></div>
                </div>

                <!-- Post Workout Challenge Form (creator only) -->
                <div id="postChallengePanel" style="display:none; background:var(--steel); border:2px solid var(--primary); padding:30px; margin-bottom:30px;">
                    <h3 style="font-family:'Bebas Neue',cursive;font-size:28px;color:var(--primary);letter-spacing:2px;margin-bottom:20px;">POST WORKOUT CHALLENGE</h3>
                    <div class="form-group">
                        <label>Challenge Title</label>
                        <input id="challengeTitle" type="text" placeholder="Monday Push Day üí™">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="challengeDesc" rows="2" placeholder="Add notes, motivation, or instructions..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Exercises</label>
                        <div id="challengeExerciseContainer">
                            <div class="exercise-inputs">
                                <input type="text" placeholder="Exercise name">
                                <input type="number" placeholder="Sets">
                                <input type="number" placeholder="Reps">
                                <input type="text" placeholder="Notes (optional)">
                            </div>
                        </div>
                        <button type="button" class="add-exercise-btn" onclick="addChallengeExercise()">+ Add Exercise</button>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button class="submit-btn" style="margin:0;padding:15px 30px;width:auto;" onclick="handlePostChallenge()">Post Challenge</button>
                        <button style="background:transparent;border:2px solid #555;color:#999;padding:15px 30px;font-family:'Oswald',sans-serif;font-size:14px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;" onclick="document.getElementById('postChallengePanel').style.display='none'">Cancel</button>
                    </div>
                </div>

                <div id="groupChallengesFeed">
                    <!-- Challenges loaded by JS -->
                </div>
            </div>

        </div>
        <!-- End My Groups Page -->

        <!-- Profile Page -->
        <div class="profile-page">
            <div class="profile-header">
                <div class="profile-top">
                    <div class="profile-avatar-large" id="profileInitials">MK</div>
                    <div class="profile-info">
                        <h1 class="profile-name" id="profileName">Marcus King</h1>
                        <div class="profile-username" id="profileUsername">@marcusking</div>
                        <p class="profile-bio" id="profileBio">Powerlifter | 5 AM Grind | Chasing 500lb deadlift üí™</p>
                        <div class="profile-stats-row">
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="profileWorkoutCount">0</div>
                                <div class="profile-stat-label">Workouts</div>
                            </div>
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="profileFollowers">0</div>
                                <div class="profile-stat-label">Followers</div>
                            </div>
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="profileFollowing">0</div>
                                <div class="profile-stat-label">Following</div>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="edit-profile-btn" onclick="openEditProfile()">Edit Profile</button>
                            <button class="logout-btn" onclick="logout()">Logout</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-tabs">
                <button class="profile-tab active" onclick="switchProfileTab('workouts')">Workouts</button>
                <button class="profile-tab" onclick="switchProfileTab('achievements')">Achievements</button>
                <button class="profile-tab" onclick="switchProfileTab('stats')">Stats</button>
            </div>

            <div class="profile-content">
                <!-- Workouts Tab -->
                <div class="profile-tab-content active" id="workouts-tab">
                    <div id="profileWorkoutFeed" class="activity-feed"></div>
                </div>

                <!-- Achievements Tab -->
                <div class="profile-tab-content" id="achievements-tab">
                    <div class="profile-achievements" id="achievementsGrid"></div>
                </div>

                <!-- Stats Tab -->
                <div class="profile-tab-content" id="stats-tab">
                    <div class="chart-container">
                        <h2 class="chart-title">My Workout Stats</h2>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-box-label">Total Workouts</div>
                                <div class="stat-box-value" id="statTotalWorkouts">0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-box-label">Total Exercises</div>
                                <div class="stat-box-value" id="statTotalExercises">0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-box-label">Total Minutes</div>
                                <div class="stat-box-value" id="statTotalMinutes">0</div>
                            </div>
                        </div>
                        <div id="recentWorkoutsList" style="margin-top:30px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Profile Page -->

        <!-- User Profile View Page (for viewing other users) -->
        <div class="profile-page" id="userProfileView" style="display:none;">
            <div class="profile-header">
                <button class="back-to-groups" onclick="closeUserProfile()" style="margin-bottom:15px;color:#ccc;">‚Üê Back to Feed</button>
                <div class="profile-top">
                    <div class="profile-avatar-large" id="viewUserAvatar">MK</div>
                    <div class="profile-info">
                        <h1 class="profile-name" id="viewUserName">User Name</h1>
                        <div class="profile-username" id="viewUserUsername">@username</div>
                        <p class="profile-bio" id="viewUserBio">Bio goes here</p>
                        <div class="profile-stats-row">
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="viewUserWorkoutCount">0</div>
                                <div class="profile-stat-label">Workouts</div>
                            </div>
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="viewUserFollowers">0</div>
                                <div class="profile-stat-label">Followers</div>
                            </div>
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="viewUserFollowing">0</div>
                                <div class="profile-stat-label">Following</div>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="edit-profile-btn" id="viewUserFollowBtn" onclick="toggleFollowOnProfile()">Follow</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-tabs">
                <button class="profile-tab active">Workouts</button>
            </div>

            <div class="profile-content">
                <div class="profile-tab-content active">
                    <div id="viewUserWorkoutFeed" class="activity-feed"></div>
                </div>
            </div>
        </div>
        <!-- End User Profile View Page -->

        <!-- Edit Profile Modal -->
        <div class="modal" id="editProfileModal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeEditProfile()">√ó</button>
                <h2>Edit Profile</h2>
                <form id="editProfileForm">
                    <!-- Profile Picture -->
                    <div class="form-group">
                        <label>Profile Picture</label>
                        <div style="display:flex;gap:20px;align-items:center;">
                            <div id="editProfileAvatar" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',cursive;font-size:32px;border:3px solid var(--primary);flex-shrink:0;overflow:hidden;">
                                <img id="editProfileAvatarImg" style="width:100%;height:100%;object-fit:cover;display:none;" alt="">
                                <span id="editProfileAvatarInitials"></span>
                            </div>
                            <div style="flex:1;">
                                <input type="file" id="profilePicInput" accept="image/*" style="display:none;">
                                <button type="button" onclick="document.getElementById('profilePicInput').click()"
                                    style="background:var(--primary);color:#fff;border:none;padding:12px 20px;font-family:'Oswald',sans-serif;font-size:14px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;margin-bottom:8px;width:100%;">
                                    Upload Photo
                                </button>
                                <button type="button" id="removeProfilePicBtn" onclick="removeProfilePic()" style="display:none;background:transparent;border:2px solid #555;color:#999;padding:10px 20px;font-family:'Oswald',sans-serif;font-size:13px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;width:100%;">
                                    Remove Photo
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Full Name</label>
                        <input id="editFullName" type="text" placeholder="Your name" required>
                    </div>

                    <div class="form-group">
                        <label>Username</label>
                        <input id="editUsername" type="text" placeholder="username" required style="text-transform:lowercase;" oninput="this.value=this.value.toLowerCase().replace(/[^a-z0-9_]/g,'')">
                        <small style="display:block;color:#999;font-size:12px;margin-top:5px;">Letters, numbers, and underscores only</small>
                    </div>

                    <div class="form-group">
                        <label>Bio</label>
                        <textarea id="editBio" rows="3" placeholder="Tell us about yourself..."></textarea>
                    </div>

                    <button type="button" class="submit-btn" onclick="handleSaveProfile()">Save Changes</button>
                </form>
            </div>
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav>
        <a href="#" class="nav-link active" data-page="feed" data-icon="üè†">
            <span>Feed</span>
        </a>
        <a href="#" class="nav-link" data-page="progress" data-icon="üìä">
            <span>Progress</span>
        </a>
        <div class="log-btn-container">
            <button class="log-btn" onclick="openModal()">
                <span>+</span>
            </button>
        </div>
        <a href="#" class="nav-link" data-page="groups" data-icon="üë•">
            <span>Groups</span>
        </a>
        <a href="#" class="nav-link" data-page="profile" data-icon="üë§">
            <span>Profile</span>
        </a>
    </nav>

    <!-- Log Workout Modal -->
    <div class="modal" id="workoutModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <h2>Log New Workout</h2>
            <form id="workoutForm">
                <div class="form-group">
                    <label>Workout Name</label>
                    <input id="workoutName" type="text" placeholder="e.g., PUSH DAY - CHEST & TRICEPS" required>
                </div>
                
                <div class="form-group">
                    <label>Workout Type</label>
                    <select id="workoutType" required>
                        <option value="">Select type</option>
                        <option value="push">Push (Chest, Shoulders, Triceps)</option>
                        <option value="pull">Pull (Back, Biceps)</option>
                        <option value="legs">Legs</option>
                        <option value="upper">Upper Body</option>
                        <option value="lower">Lower Body</option>
                        <option value="full">Full Body</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Add Photo (Optional)</label>
                    <div class="photo-upload-zone" id="photoZone" onclick="document.getElementById('photoInput').click()">
                        <div class="upload-icon">üì∏</div>
                        <div class="upload-text">Click to upload workout photo</div>
                        <img id="previewImage" class="preview-image" alt="Workout preview">
                        <button type="button" class="remove-photo" id="removePhoto">√ó</button>
                    </div>
                    <input type="file" id="photoInput" accept="image/*">
                </div>

                <div class="form-group">
                    <label>Caption (Optional)</label>
                    <textarea id="captionInput" rows="2" placeholder="Feeling strong today! üí™"></textarea>
                </div>

                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input id="workoutDuration" type="number" placeholder="60" required>
                </div>

                <div class="form-group">
                    <label>Exercises</label>
                    <div id="exerciseContainer">
                        <div class="exercise-inputs">
                            <input type="text" placeholder="Exercise name" required>
                            <input type="number" placeholder="Sets" required>
                            <input type="number" placeholder="Reps" required>
                            <input type="number" placeholder="Weight (lbs)" required>
                        </div>
                    </div>
                    <button type="button" class="add-exercise-btn" onclick="addExercise()">+ Add Exercise</button>
                </div>

                <div class="form-group">
                    <label>Notes (optional)</label>
                    <textarea rows="3" placeholder="How did you feel? Any PRs?"></textarea>
                </div>

                <button type="button" class="submit-btn" onclick="handleLogWorkout()">Log Workout</button>
            </form>
        </div>
    </div>

    <!-- Signup Page -->
    <div class="auth-page" id="signupPage">
        <div class="auth-container">
            <div class="auth-logo">
                <div class="auth-logo-text">SPLITSHARE</div>
                <div class="auth-tagline">Track Your Strength</div>
            </div>
            <div class="auth-form">
                <h2 class="auth-title">Create Account</h2>
                <div class="auth-error" id="signupError" style="display:none; color:#ff6b35; font-size:14px; margin-bottom:15px; padding:10px; background:rgba(255,107,53,0.1); border-left:3px solid #ff6b35;"></div>
                <form id="signupForm" onsubmit="return false;">
                    <div class="auth-input-group">
                        <label>Full Name</label>
                        <input id="signupName" type="text" placeholder="Marcus King">
                    </div>
                    <div class="auth-input-group">
                        <label>Username</label>
                        <input id="signupUsername" type="text" placeholder="marcusking">
                    </div>
                    <div class="auth-input-group">
                        <label>Email</label>
                        <input id="signupEmail" type="email" placeholder="marcus@example.com">
                    </div>
                    <div class="auth-input-group">
                        <label>Password</label>
                        <input id="signupPassword" type="password" placeholder="Min. 6 characters">
                    </div>
                    <button type="button" class="auth-submit-btn" onclick="handleSignup()">Create Account</button>
                </form>
                <div class="auth-switch">
                    Already have an account? <span class="auth-switch-link" onclick="showLogin()">Log in</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div class="auth-page" id="loginPage">
        <div class="auth-container">
            <div class="auth-logo">
                <div class="auth-logo-text">SPLITSHARE</div>
                <div class="auth-tagline">Track Your Strength</div>
            </div>
            <div class="auth-form">
                <h2 class="auth-title">Welcome Back</h2>
                <div class="auth-error" id="loginError" style="display:none; color:#ff6b35; font-size:14px; margin-bottom:15px; padding:10px; background:rgba(255,107,53,0.1); border-left:3px solid #ff6b35;"></div>
                <form id="loginForm" onsubmit="return false;">
                    <div class="auth-input-group">
                        <label>Email Address</label>
                        <input id="loginIdentifier" type="email" placeholder="marcus@example.com">
                    </div>
                    <div class="auth-input-group">
                        <label>Password</label>
                        <input id="loginPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="button" class="auth-submit-btn" onclick="handleLogin()">Log In</button>
                </form>
                <div class="auth-switch">
                    Don't have an account? <span class="auth-switch-link" onclick="showSignup()">Sign up</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation System
        const navLinks = document.querySelectorAll('.nav-link');
        const feedPage = document.querySelector('.feed-page');
        const progressPage = document.querySelector('.progress-page');
        const groupsPage = document.querySelector('.groups-page');
        const profilePage = document.querySelector('.profile-page');

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.dataset.page;
                
                // Update active nav link
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Hide all pages
                if (feedPage) feedPage.classList.remove('active');
                if (progressPage) progressPage.classList.remove('active');
                if (groupsPage) groupsPage.classList.remove('active');
                if (profilePage) profilePage.classList.remove('active');
                
                // Show selected page
                if (page === 'feed' && feedPage) {
                    feedPage.classList.add('active');
                    loadFeedFromSupabase();
                } else if (page === 'progress' && progressPage) {
                    progressPage.classList.add('active');
                    setTimeout(() => loadProgressPage(), 100);
                } else if (page === 'groups' && groupsPage) {
                    groupsPage.classList.add('active');
                    closeGroupDetail();
                    loadGroupsPage();
                } else if (page === 'profile' && profilePage) {
                    profilePage.classList.add('active');
                    refreshFollowCounts();
                }
            });
        });

        // ‚îÄ‚îÄ GROUPS SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let currentGroupData = null; // group object currently being viewed

        // UI toggles
        function showCreateGroupPanel() {
            document.getElementById('createGroupPanel').style.display = 'block';
            document.getElementById('joinGroupPanel').style.display = 'none';
        }
        function hideCreateGroupPanel() {
            document.getElementById('createGroupPanel').style.display = 'none';
        }
        function showJoinGroupPanel() {
            document.getElementById('joinGroupPanel').style.display = 'block';
            document.getElementById('createGroupPanel').style.display = 'none';
            document.getElementById('searchGroupResult').innerHTML = '';
        }
        function hideJoinGroupPanel() {
            document.getElementById('joinGroupPanel').style.display = 'none';
        }
        function toggleJoinCode() {
            const priv = document.getElementById('newGroupPrivacy').value === 'private';
            document.getElementById('joinCodeRow').style.display = priv ? 'block' : 'none';
        }
        function addChallengeExercise() {
            const c = document.getElementById('challengeExerciseContainer');
            const div = document.createElement('div');
            div.className = 'exercise-inputs';
            div.innerHTML = `<input type="text" placeholder="Exercise name"><input type="number" placeholder="Sets"><input type="number" placeholder="Reps"><input type="text" placeholder="Notes (optional)">`;
            c.appendChild(div);
        }

        // Load groups page
        async function loadGroupsPage() {
            const user = getCurrentUser();
            if (!user) return;
            try {
                // Get groups the user is a member of
                const memberships = await sb(`group_members?user_id=eq.${window._sbUserId}&select=group_id,role,groups(id,group_id,name,description,privacy,creator_id,created_at)`);
                const grid = document.getElementById('myGroupsGrid');
                const empty = document.getElementById('myGroupsEmpty');
                if (!memberships || memberships.length === 0) {
                    grid.innerHTML = '';
                    empty.style.display = 'block';
                    return;
                }
                empty.style.display = 'none';
                grid.innerHTML = memberships.map(m => {
                    const g = m.groups;
                    const isCreator = g.creator_id === window._sbUserId;
                    return `<div class="group-card" onclick="openGroupDetail('${g.id}')">
                        <div class="group-header-banner">
                            <h3 class="group-name">${g.name}</h3>
                            <div class="group-members-count">${g.privacy === 'private' ? 'üîí Private' : 'üåê Public'} ¬∑ ID: ${g.group_id}</div>
                        </div>
                        <div class="group-body">
                            <p class="group-description">${g.description || 'No description.'}</p>
                            <div style="margin-top:10px;">
                                ${isCreator ? '<span style="background:var(--primary);color:#fff;padding:4px 10px;font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;">CREATOR</span>' : '<span style="background:#333;color:#999;padding:4px 10px;font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;">MEMBER</span>'}
                            </div>
                            <button class="view-group-btn" style="margin-top:15px;">View Group</button>
                        </div>
                    </div>`;
                }).join('');
            } catch(e) { console.warn('loadGroupsPage error:', e.message); }
        }

        // Create group
        async function handleCreateGroup() {
            const name    = document.getElementById('newGroupName').value.trim();
            const groupId = document.getElementById('newGroupId').value.trim().toLowerCase();
            const desc    = document.getElementById('newGroupDesc').value.trim();
            const privacy = document.getElementById('newGroupPrivacy').value;
            const code    = document.getElementById('newGroupCode').value.trim().toUpperCase();

            if (!name || !groupId) { alert('Group name and ID are required.'); return; }
            if (privacy === 'private' && !code) { alert('Please set a join code for private groups.'); return; }

            try {
                // Check group ID available
                const existing = await sb(`groups?group_id=eq.${groupId}&select=id`);
                if (existing && existing.length > 0) { alert('That Group ID is already taken. Choose another.'); return; }

                const group = {
                    group_id: groupId,
                    name,
                    description: desc,
                    privacy,
                    join_code: privacy === 'private' ? code : null,
                    creator_id: window._sbUserId
                };
                const saved = await sb('groups', { method: 'POST', body: group });
                const newGroup = saved[0];

                // Auto-join as creator
                await sb('group_members', { method: 'POST', body: { group_id: newGroup.id, user_id: window._sbUserId, role: 'creator' } });

                hideCreateGroupPanel();
                document.getElementById('newGroupName').value = '';
                document.getElementById('newGroupId').value = '';
                document.getElementById('newGroupDesc').value = '';
                document.getElementById('newGroupCode').value = '';

                await loadGroupsPage();
                openGroupDetail(newGroup.id);
            } catch(e) { alert('Error creating group: ' + e.message); }
        }

        // Search for group to join
        async function handleSearchGroup() {
            const searchId = document.getElementById('searchGroupId').value.trim().toLowerCase();
            const result = document.getElementById('searchGroupResult');
            if (!searchId) { result.innerHTML = '<p style="color:#ff6b35;">Please enter a Group ID.</p>'; return; }

            try {
                const groups = await sb(`groups?group_id=eq.${searchId}&select=*`);
                if (!groups || groups.length === 0) {
                    result.innerHTML = '<p style="color:#ff6b35;">No group found with that ID.</p>'; return;
                }
                const g = groups[0];
                // Check if already member
                const mem = await sb(`group_members?group_id=eq.${g.id}&user_id=eq.${window._sbUserId}&select=id`);
                const isMember = mem && mem.length > 0;

                result.innerHTML = `
                    <div style="background:var(--iron);border-left:4px solid var(--primary);padding:20px;margin-top:10px;">
                        <div style="font-family:'Bebas Neue',cursive;font-size:24px;color:var(--white);margin-bottom:5px;">${g.name}</div>
                        <div style="font-size:13px;color:#999;margin-bottom:10px;">${g.privacy === 'private' ? 'üîí Private Group' : 'üåê Public Group'} ¬∑ ID: ${g.group_id}</div>
                        <p style="color:#ccc;font-size:14px;margin-bottom:15px;">${g.description || ''}</p>
                        ${isMember
                            ? '<span style="color:#4ade80;font-size:14px;font-weight:600;">‚úÖ You are already a member</span>'
                            : g.privacy === 'private'
                                ? `<div style="display:flex;gap:10px;align-items:center;margin-top:10px;">
                                    <input id="joinCodeInput" type="text" placeholder="Enter join code" style="padding:12px;background:var(--steel);border:2px solid #333;color:#fff;font-family:'Oswald',sans-serif;font-size:14px;flex:1;text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()">
                                    <button class="submit-btn" style="margin:0;padding:12px 25px;width:auto;" onclick="handleJoinGroup('${g.id}','${g.group_id}',true)">Join</button>
                                   </div>`
                                : `<button class="submit-btn" style="margin:0;padding:12px 30px;width:auto;" onclick="handleJoinGroup('${g.id}','${g.group_id}',false)">Join Group</button>`
                        }
                    </div>`;
            } catch(e) { result.innerHTML = `<p style="color:#ff6b35;">Error: ${e.message}</p>`; }
        }

        async function handleJoinGroup(groupUUID, groupId, isPrivate) {
            if (isPrivate) {
                const enteredCode = document.getElementById('joinCodeInput')?.value.trim().toUpperCase();
                const groups = await sb(`groups?id=eq.${groupUUID}&select=join_code`);
                if (!groups || groups[0].join_code !== enteredCode) {
                    alert('Incorrect join code.'); return;
                }
            }
            try {
                await sb('group_members', { method: 'POST', body: { group_id: groupUUID, user_id: window._sbUserId, role: 'member' } });
                hideJoinGroupPanel();
                await loadGroupsPage();
                openGroupDetail(groupUUID);
            } catch(e) { alert('Error joining group: ' + e.message); }
        }

        // Open group detail view
        async function openGroupDetail(groupUUID) {
            document.getElementById('groupsListView').style.display = 'none';
            document.getElementById('groupDetailView').style.display = 'block';

            try {
                const groups = await sb(`groups?id=eq.${groupUUID}&select=*`);
                const g = groups[0];
                currentGroupData = g;

                const members = await sb(`group_members?group_id=eq.${groupUUID}&select=user_id,role,profiles(full_name,initials)`);
                const memberCount = members.length;
                const isCreator = g.creator_id === window._sbUserId;

                document.getElementById('groupDetailTitle').textContent = g.name;
                document.getElementById('groupDetailInfo').innerHTML = `
                    <span>üë• ${memberCount} member${memberCount !== 1 ? 's' : ''}</span>
                    <span>${g.privacy === 'private' ? 'üîí Private' : 'üåê Public'}</span>
                    <span>üÜî ${g.group_id}</span>
                    ${isCreator && g.privacy === 'private' ? `<span>üîë Join Code: <strong style="color:var(--primary)">${g.join_code}</strong></span>` : ''}`;

                const actions = document.getElementById('groupDetailActions');
                actions.innerHTML = isCreator
                    ? `<button class="post-workout-btn" onclick="document.getElementById('postChallengePanel').style.display='block'">üìù Post Workout Challenge</button>
                       <button style="background:transparent;border:2px solid #666;color:#999;padding:12px 25px;font-family:'Oswald',sans-serif;font-size:14px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;" onclick="handleDeleteGroup('${g.id}')">üóë Delete Group</button>`
                    : `<button style="background:transparent;border:2px solid #666;color:#999;padding:12px 25px;font-family:'Oswald',sans-serif;font-size:14px;text-transform:uppercase;letter-spacing:1px;cursor:pointer;" onclick="handleLeaveGroup('${g.id}')">Leave Group</button>`;

                await loadGroupChallenges(groupUUID, members, isCreator);
            } catch(e) { console.warn('openGroupDetail error:', e.message); }
        }

        async function loadGroupChallenges(groupUUID, members, isCreator) {
            const feed = document.getElementById('groupChallengesFeed');
            try {
                const challenges = await sb(`group_challenges?group_id=eq.${groupUUID}&order=created_at.desc&select=*`);
                if (!challenges || challenges.length === 0) {
                    feed.innerHTML = `<div style="text-align:center;padding:60px 20px;color:#999;">
                        <div style="font-size:48px;margin-bottom:15px;">üèãÔ∏è</div>
                        <h3 style="font-family:'Bebas Neue',cursive;font-size:28px;color:var(--primary);margin-bottom:10px;">NO CHALLENGES YET</h3>
                        <p>${isCreator ? 'Post the first workout challenge above!' : 'Waiting for the group creator to post a challenge.'}</p>
                    </div>`; return;
                }

                // Get all completions for this group's challenges
                const challengeIds = challenges.map(c => c.id);
                const completions = await sb(`group_completions?challenge_id=in.(${challengeIds.join(',')})&select=*,profiles(full_name,initials)`);

                feed.innerHTML = challenges.map(ch => {
                    const chCompletions = completions.filter(c => c.challenge_id === ch.id);
                    const myCompletion = chCompletions.find(c => c.user_id === window._sbUserId);
                    const exList = (ch.exercises || []).map(ex =>
                        `<div class="exercise-item">
                            <span class="exercise-name">${ex.name}</span>
                            <span class="exercise-details">${ex.sets||'?'} √ó ${ex.reps||'?'}${ex.notes ? ' ¬∑ ' + ex.notes : ''}</span>
                        </div>`).join('');

                    const completionItems = chCompletions.map(c =>
                        `<div class="completion-item">
                            <div class="completion-avatar">${c.profiles?.initials || '?'}</div>
                            <div class="completion-info">
                                <div class="completion-name">${c.profiles?.full_name || 'Unknown'}</div>
                                <div class="completion-time">${new Date(c.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div>
                            </div>
                            <span class="completion-status">‚úÖ</span>
                        </div>`).join('');

                    const dateStr = new Date(ch.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
                    return `<div class="group-workout-card">
                        <div class="workout-posted-by">
                            <div class="posted-by-label">Posted ${dateStr}</div>
                            <div class="posted-by-name">${ch.title}</div>
                        </div>
                        ${ch.description ? `<p class="workout-challenge-description">${ch.description}</p>` : ''}
                        <div class="workout-challenge-exercises"><div class="exercise-list">${exList || '<div class="exercise-item"><span class="exercise-name">No exercises listed</span></div>'}</div></div>
                        <div class="completions-section">
                            <div class="completions-header">
                                <div class="completions-title">Completions (${chCompletions.length})</div>
                                ${!myCompletion
                                    ? `<button class="complete-workout-btn" onclick="handleMarkComplete('${ch.id}', this)">‚úì Mark Complete</button>`
                                    : `<button class="complete-workout-btn completed" disabled>‚úÖ Completed!</button>`
                                }
                            </div>
                            <div class="completions-grid">${completionItems || '<p style="color:#666;font-size:13px;padding:10px;">No completions yet. Be the first!</p>'}</div>
                        </div>
                        ${isCreator ? `<div style="padding:10px 30px;border-top:1px solid #333;"><button onclick="handleDeleteChallenge('${ch.id}')" style="background:transparent;border:none;color:#555;font-family:'Oswald',sans-serif;font-size:13px;cursor:pointer;text-transform:uppercase;letter-spacing:1px;">üóë Delete Challenge</button></div>` : ''}
                    </div>`;
                }).join('');
            } catch(e) { feed.innerHTML = `<p style="color:#ff6b35;padding:20px;">Error loading challenges: ${e.message}</p>`; }
        }

        // Post workout challenge
        async function handlePostChallenge() {
            const title = document.getElementById('challengeTitle').value.trim();
            const desc  = document.getElementById('challengeDesc').value.trim();
            if (!title) { alert('Please enter a challenge title.'); return; }

            const exercises = [];
            document.querySelectorAll('#challengeExerciseContainer .exercise-inputs').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const name = inputs[0]?.value.trim();
                if (name) exercises.push({ name, sets: inputs[1]?.value || '', reps: inputs[2]?.value || '', notes: inputs[3]?.value || '' });
            });

            try {
                await sb('group_challenges', { method: 'POST', body: {
                    group_id: currentGroupData.id,
                    creator_id: window._sbUserId,
                    title,
                    description: desc || null,
                    exercises
                }});
                document.getElementById('postChallengePanel').style.display = 'none';
                document.getElementById('challengeTitle').value = '';
                document.getElementById('challengeDesc').value = '';
                document.getElementById('challengeExerciseContainer').innerHTML = `<div class="exercise-inputs"><input type="text" placeholder="Exercise name"><input type="number" placeholder="Sets"><input type="number" placeholder="Reps"><input type="text" placeholder="Notes (optional)"></div>`;
                const members = await sb(`group_members?group_id=eq.${currentGroupData.id}&select=user_id,role,profiles(full_name,initials)`);
                await loadGroupChallenges(currentGroupData.id, members, true);
            } catch(e) { alert('Error posting challenge: ' + e.message); }
        }

        // Mark challenge complete
        async function handleMarkComplete(challengeId, btn) {
            try {
                await sb('group_completions', { method: 'POST', body: { challenge_id: challengeId, user_id: window._sbUserId, group_id: currentGroupData.id } });
                btn.textContent = '‚úÖ Completed!';
                btn.classList.add('completed');
                btn.disabled = true;
                // Reload to show new completion
                const members = await sb(`group_members?group_id=eq.${currentGroupData.id}&select=user_id,role,profiles(full_name,initials)`);
                await loadGroupChallenges(currentGroupData.id, members, currentGroupData.creator_id === window._sbUserId);
            } catch(e) { alert('Error: ' + e.message); }
        }

        async function handleDeleteChallenge(challengeId) {
            if (!confirm('Delete this challenge?')) return;
            try {
                await sb(`group_challenges?id=eq.${challengeId}`, { method: 'DELETE', prefer: 'return=minimal' });
                const members = await sb(`group_members?group_id=eq.${currentGroupData.id}&select=user_id,role,profiles(full_name,initials)`);
                await loadGroupChallenges(currentGroupData.id, members, true);
            } catch(e) { alert('Error: ' + e.message); }
        }

        async function handleLeaveGroup(groupUUID) {
            if (!confirm('Leave this group?')) return;
            try {
                await sb(`group_members?group_id=eq.${groupUUID}&user_id=eq.${window._sbUserId}`, { method: 'DELETE', prefer: 'return=minimal' });
                closeGroupDetail();
                await loadGroupsPage();
            } catch(e) { alert('Error: ' + e.message); }
        }

        async function handleDeleteGroup(groupUUID) {
            if (!confirm('Permanently delete this group and all its challenges? This cannot be undone.')) return;
            try {
                await sb(`groups?id=eq.${groupUUID}`, { method: 'DELETE', prefer: 'return=minimal' });
                closeGroupDetail();
                await loadGroupsPage();
            } catch(e) { alert('Error: ' + e.message); }
        }

        function closeGroupDetail() {
            document.getElementById('groupDetailView').style.display = 'none';
            document.getElementById('groupsListView').style.display = 'block';
            document.getElementById('postChallengePanel').style.display = 'none';
            currentGroupData = null;
        }


        // ‚îÄ‚îÄ PROGRESS PAGE ‚Äî REAL DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let progressChart = null;
        let progressExerciseData = {}; // { 'Bench Press': [{date, weight, sets, reps}] }

        function buildProgressFromWorkouts(workouts) {
            // Collect all exercises with weights from all workouts
            const map = {};
            workouts.forEach(w => {
                const date = new Date(w.created_at || w.date);
                (w.exercises || []).forEach(ex => {
                    const weight = parseFloat(ex.weight);
                    if (!ex.name || !weight || isNaN(weight)) return;
                    const key = ex.name.trim();
                    if (!map[key]) map[key] = [];
                    map[key].push({
                        date,
                        dateLabel: date.toLocaleDateString('en-US', { month:'short', day:'numeric' }),
                        weight,
                        sets: ex.sets || '?',
                        reps: ex.reps || '?',
                        volume: weight * (parseInt(ex.sets)||1) * (parseInt(ex.reps)||1)
                    });
                });
            });
            // Sort each exercise by date ascending
            Object.keys(map).forEach(k => map[k].sort((a,b) => a.date - b.date));
            return map;
        }

        function loadProgressPage() {
            const user = getCurrentUser();
            if (!user) return;

            const workouts = user.workouts || [];
            progressExerciseData = buildProgressFromWorkouts(workouts);
            const exercises = Object.keys(progressExerciseData);

            const selector = document.getElementById('exerciseSelector');
            const emptyState = document.getElementById('progressEmptyState');
            const chartContainer = document.getElementById('progressChartContainer');
            const historyContainer = document.getElementById('progressHistoryContainer');

            if (exercises.length === 0) {
                if (selector) selector.innerHTML = '';
                if (emptyState) emptyState.style.display = 'block';
                if (chartContainer) chartContainer.style.display = 'none';
                if (historyContainer) historyContainer.style.display = 'none';
                return;
            }

            if (emptyState) emptyState.style.display = 'none';
            if (chartContainer) chartContainer.style.display = 'block';
            if (historyContainer) historyContainer.style.display = 'block';

            // Build exercise selector buttons
            if (selector) {
                selector.innerHTML = exercises.map((name, i) =>
                    `<button class="exercise-btn ${i===0?'active':''}" onclick="selectProgressExercise(this,'${name.replace(/'/g,"\\'")}')">${name}</button>`
                ).join('');
            }

            // Show first exercise by default
            renderProgressChart(exercises[0]);
        }

        function selectProgressExercise(btn, name) {
            document.querySelectorAll('#exerciseSelector .exercise-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderProgressChart(name);
        }

        function renderProgressChart(exerciseName) {
            const entries = progressExerciseData[exerciseName];
            if (!entries || entries.length === 0) return;

            const pr     = Math.max(...entries.map(e => e.weight));
            const first  = entries[0].weight;
            const diff   = pr - first;
            const diffStr = (diff >= 0 ? '+' : '') + diff + ' lbs';

            document.getElementById('chartTitle').innerHTML =
                `${exerciseName} Progress <span class="pr-badge">PR: ${pr} LBS</span>`;
            document.getElementById('currentPR').textContent = pr + ' lbs';
            document.getElementById('totalIncrease').textContent = diffStr;
            document.getElementById('sessionsLogged').textContent = entries.length;

            // Draw chart
            const canvas = document.getElementById('progressChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            if (window.progressChart) { window.progressChart.destroy(); window.progressChart = null; }

            window.progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: entries.map(e => e.dateLabel),
                    datasets: [{
                        label: 'Weight (lbs)',
                        data: entries.map(e => e.weight),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255,107,53,0.15)',
                        borderWidth: 4,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 7,
                        pointBackgroundColor: entries.map(e => e.weight === pr ? '#ffb347' : '#ff6b35'),
                        pointBorderColor: '#fff',
                        pointBorderWidth: 3,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#2a2a2a',
                            titleColor: '#ff6b35',
                            bodyColor: '#fff',
                            borderColor: '#ff6b35',
                            borderWidth: 2,
                            padding: 15,
                            displayColors: false,
                            callbacks: {
                                label: c => c.parsed.y + ' lbs',
                                afterLabel: c => {
                                    const e = entries[c.dataIndex];
                                    return `${e.sets} sets √ó ${e.reps} reps`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(255,255,255,0.08)' },
                            border: { color: '#333' },
                            ticks: { color: '#999', font: { family: 'Roboto Mono', size: 13 }, callback: v => v + ' lbs' }
                        },
                        x: {
                            grid: { color: 'rgba(255,255,255,0.08)' },
                            border: { color: '#333' },
                            ticks: { color: '#999', font: { family: 'Roboto Mono', size: 13 } }
                        }
                    },
                    interaction: { intersect: false, mode: 'index' }
                }
            });

            // Build history table
            const tbody = document.getElementById('historyTableBody');
            if (tbody) {
                const reversed = [...entries].reverse();
                tbody.innerHTML = reversed.map((e, i) => {
                    const prev = reversed[i + 1];
                    let trendHTML = '<span class="trend-neutral">‚Äî</span>';
                    if (prev) {
                        const d = e.weight - prev.weight;
                        if (d > 0) trendHTML = `<span class="trend-up">‚Üë +${d} lbs</span>`;
                        else if (d < 0) trendHTML = `<span class="trend-down">‚Üì ${d} lbs</span>`;
                    }
                    const vol = e.weight * (parseInt(e.sets)||1) * (parseInt(e.reps)||1);
                    const isPR = e.weight === pr;
                    return `<tr${isPR ? ' style="background:rgba(255,179,71,0.08);"' : ''}>
                        <td>${e.dateLabel}</td>
                        <td>${exerciseName}${isPR ? ' <span class="pr-badge" style="font-size:10px;">PR</span>' : ''}</td>
                        <td>${e.weight} lbs</td>
                        <td>${e.sets} √ó ${e.reps}</td>
                        <td>${vol.toLocaleString()} lbs</td>
                        <td>${trendHTML}</td>
                    </tr>`;
                }).join('');
            }
        }

        // Exercise selector
        document.querySelectorAll('.exercise-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.exercise-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Toggle workout details
        function toggleDetails(button) {
            button.classList.toggle('active');
            const content = button.nextElementSibling;
            content.classList.toggle('active');
        }

        // Photo Upload Functionality
        const photoInput = document.getElementById('photoInput');
        const photoZone = document.getElementById('photoZone');
        const previewImage = document.getElementById('previewImage');
        const removePhoto = document.getElementById('removePhoto');

        if (photoInput && photoZone && previewImage && removePhoto) {
            photoInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        previewImage.classList.add('active');
                        photoZone.classList.add('has-image');
                        removePhoto.classList.add('active');
                        const uploadIcon = photoZone.querySelector('.upload-icon');
                        const uploadText = photoZone.querySelector('.upload-text');
                        if (uploadIcon) uploadIcon.style.display = 'none';
                        if (uploadText) uploadText.style.display = 'none';
                    }
                    reader.readAsDataURL(file);
                }
            });

            removePhoto.addEventListener('click', function(e) {
                e.stopPropagation();
                photoInput.value = '';
                previewImage.classList.remove('active');
                photoZone.classList.remove('has-image');
                removePhoto.classList.remove('active');
                const uploadIcon = photoZone.querySelector('.upload-icon');
                const uploadText = photoZone.querySelector('.upload-text');
                if (uploadIcon) uploadIcon.style.display = 'block';
                if (uploadText) uploadText.style.display = 'block';
            });
        }

        function openModal() {
            document.getElementById('workoutModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('workoutModal').classList.remove('active');
        }

        function addExercise() {
            const container = document.getElementById('exerciseContainer');
            const newExercise = document.createElement('div');
            newExercise.className = 'exercise-inputs';
            newExercise.innerHTML = `
                <input type="text" placeholder="Exercise name" required>
                <input type="number" placeholder="Sets" required>
                <input type="number" placeholder="Reps" required>
                <input type="number" placeholder="Weight (lbs)" required>
            `;
            container.appendChild(newExercise);
        }

        async function handleLogWorkout() {
            const workoutName = document.getElementById('workoutName')?.value.trim();
            const duration    = parseInt(document.getElementById('workoutDuration')?.value) || 0;
            const caption     = document.getElementById('captionInput')?.value.trim();
            const previewImg  = document.getElementById('previewImage');
            const photoSrc    = previewImg?.classList.contains('active') ? previewImg.src : null;

            if (!workoutName) { alert('Please enter a workout name.'); return; }

            const user = getCurrentUser();
            if (!user) { alert('Please log in first.'); return; }

            // Gather exercises
            const exercises = [];
            document.querySelectorAll('#exerciseContainer .exercise-inputs').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const name = inputs[0]?.value.trim();
                if (name) exercises.push({
                    name,
                    sets:   inputs[1]?.value || '',
                    reps:   inputs[2]?.value || '',
                    weight: inputs[3]?.value || ''
                });
            });

            // Show saving state
            const submitBtn = document.querySelector('.submit-btn');
            if (submitBtn) { submitBtn.textContent = 'Saving...'; submitBtn.disabled = true; }

            try {
                const workoutRecord = {
                    user_id:   window._sbUserId,
                    name:      workoutName,
                    duration,
                    caption:   caption || null,
                    exercises,
                    photo_url: photoSrc || null
                };

                const saved = await sb('workouts', { method: 'POST', body: workoutRecord });

                // Update local user cache
                if (!user.workouts) user.workouts = [];
                user.workouts.unshift({ ...workoutRecord, id: saved[0]?.id, created_at: new Date().toISOString() });
                setCurrentUser(user);
                refreshProfileStats(user);
                refreshProfileWorkouts(user);
                refreshAchievements(user);
                // Refresh progress data so new exercise shows up immediately
                progressExerciseData = buildProgressFromWorkouts(user.workouts);

                // Reset form
                document.getElementById('workoutForm').reset();
                const pImg = document.getElementById('previewImage');
                const pZone = document.getElementById('photoZone');
                const rPhoto = document.getElementById('removePhoto');
                if (pImg) pImg.classList.remove('active');
                if (pZone) pZone.classList.remove('has-image');
                if (rPhoto) rPhoto.classList.remove('active');
                const uIcon = pZone?.querySelector('.upload-icon');
                const uText = pZone?.querySelector('.upload-text');
                if (uIcon) uIcon.style.display = 'block';
                if (uText) uText.style.display = 'block';
                document.getElementById('exerciseContainer').innerHTML = `<div class="exercise-inputs">
                    <input type="text" placeholder="Exercise name">
                    <input type="number" placeholder="Sets">
                    <input type="number" placeholder="Reps">
                    <input type="number" placeholder="Weight (lbs)">
                </div>`;

                closeModal();
                navigateToFeed();

                // Reload feed from Supabase so the new post appears with correct data
                await loadFeedFromSupabase();

            } catch(e) {
                alert('Failed to save workout: ' + e.message);
            } finally {
                if (submitBtn) { submitBtn.textContent = 'Log Workout'; submitBtn.disabled = false; }
            }
        }

        function refreshProfileStats(user) {
            const workouts = user.workouts || [];
            const totalWorkouts   = workouts.length;
            const totalExercises  = workouts.reduce((sum, w) => sum + (w.exercises?.length || 0), 0);
            const totalMinutes    = workouts.reduce((sum, w) => sum + (w.duration || 0), 0);

            const tw = document.getElementById('statTotalWorkouts');
            const te = document.getElementById('statTotalExercises');
            const tm = document.getElementById('statTotalMinutes');
            const wc = document.getElementById('profileWorkoutCount');

            if (tw) tw.textContent = totalWorkouts;
            if (te) te.textContent = totalExercises;
            if (tm) tm.textContent = totalMinutes;
            if (wc) wc.textContent = totalWorkouts;

            // Show recent workouts list
            const list = document.getElementById('recentWorkoutsList');
            if (list) {
                if (workouts.length === 0) {
                    list.innerHTML = `<p style="color:#999; text-align:center; padding:30px;">No workouts logged yet. Hit the + button to log your first workout!</p>`;
                } else {
                    list.innerHTML = `
                        <h3 style="font-family:'Bebas Neue',cursive; font-size:22px; letter-spacing:2px; color:var(--primary); margin-bottom:15px;">Recent Workouts</h3>
                        ${workouts.slice(0, 10).map(w => `
                            <div style="background:var(--steel); border-left:3px solid var(--primary); padding:15px 20px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <div style="font-family:'Bebas Neue',cursive; font-size:18px; letter-spacing:1px;">${w.name.toUpperCase()}</div>
                                    <div style="font-size:12px; color:#999; margin-top:3px;">${w.exercises?.length || 0} exercises ¬∑ ${w.duration || 0} min</div>
                                </div>
                                <div style="font-size:12px; color:#666; font-family:'Roboto Mono',monospace;">${new Date(w.date).toLocaleDateString()}</div>
                            </div>`).join('')}`;
                }
            }
        }

        const workoutForm = document.getElementById('workoutForm');
        if (workoutForm) workoutForm.addEventListener('submit', e => e.preventDefault());

        function handleRespect(btn) {
            const span = btn.querySelector('span:last-child');
            const count = parseInt(span.textContent) + 1;
            span.textContent = count + ' Respect';
            btn.style.color = 'var(--primary)';
        }

        // Filter tabs ‚Äî handled by switchFeedTab() inline onclick

        // Action buttons
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const text = this.textContent;
                if (text.includes('Respect')) {
                    const count = parseInt(text.match(/\d+/)[0]) + 1;
                    this.innerHTML = `<span class="action-icon">üëä</span><span>${count} Respect</span>`;
                }
            });
        });

        // Close modal on outside click
        const workoutModal = document.getElementById('workoutModal');
        if (workoutModal) {
            workoutModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // ‚îÄ‚îÄ SUPABASE CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const SUPABASE_URL = 'https://nygqoszurqvvdtndpufo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55Z3Fvc3p1cnF2dmR0bmRwdWZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NzU5NDksImV4cCI6MjA4NjM1MTk0OX0.KSd3SPRK2RULFCikjS7WpAlf8YvBiZnwsyA3OT6dzPY';

        window._ssCurrentUser = null;
        window._sbToken       = null;
        window._sbUserId      = null;

        // ‚îÄ‚îÄ CONNECTION TEST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Show a helpful banner if Supabase can't be reached
        async function testConnection() {
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/profiles?limit=1`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                if (res.ok || res.status === 401 || res.status === 406) {
                    // Any HTTP response means we can reach Supabase ‚Äî good
                    return true;
                }
                throw new Error(`HTTP ${res.status}`);
            } catch(e) {
                // Show a helpful overlay
                const banner = document.createElement('div');
                banner.style.cssText = `position:fixed;top:0;left:0;right:0;z-index:9999;background:#1a0a00;border-bottom:3px solid #ff6b35;padding:20px 25px;font-family:'Oswald',sans-serif;color:#fff;`;
                banner.innerHTML = `
                    <div style="font-size:18px;color:#ff6b35;font-weight:bold;margin-bottom:8px;">‚ö†Ô∏è CANNOT CONNECT TO SERVER</div>
                    <div style="font-size:14px;color:#ccc;line-height:1.6;">
                        Opening this file directly won't work because browsers block network requests from local files.<br>
                        <strong style="color:#ff6b35;">Fix:</strong> Host this file on any web server, or use VS Code's Live Server extension.
                    </div>`;
                document.body.appendChild(banner);
                // Push content down
                document.querySelector('main')?.style.setProperty('padding-top', '100px');
                return false;
            }
        }
        testConnection();

        // REST helper
        async function sb(path, opts = {}) {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/${path}`, {
                method: opts.method || 'GET',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${window._sbToken || SUPABASE_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': opts.prefer || 'return=representation',
                    ...opts.headers
                },
                body: opts.body ? JSON.stringify(opts.body) : undefined
            });
            if (!res.ok) {
                const e = await res.json().catch(() => ({}));
                throw new Error(e.message || e.error_description || res.statusText);
            }
            return res.status === 204 ? null : res.json();
        }

        async function sbAuth(endpoint, email, password) {
            const res = await fetch(`${SUPABASE_URL}/auth/v1/${endpoint}`, {
                method: 'POST',
                headers: { 'apikey': SUPABASE_KEY, 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error_description || data.msg || 'Auth failed');
            return data;
        }

        function getCurrentUser() { return window._ssCurrentUser; }
        function setCurrentUser(u) { window._ssCurrentUser = u; }

        function saveSession(data) {
            try {
                localStorage.setItem('sb_session', JSON.stringify({
                    access_token: data.access_token,
                    user_id: data.user.id,
                    expires_at: data.expires_at
                }));
            } catch(e) {}
        }

        // ‚îÄ‚îÄ AUTH UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function showSignup() {
            const sp = document.getElementById('signupPage');
            const lp = document.getElementById('loginPage');
            if (sp) { sp.style.display = 'flex'; sp.classList.add('active'); }
            if (lp) { lp.style.display = 'none';  lp.classList.remove('active'); }
            clearAuthErrors();
        }

        function showLogin() {
            const lp = document.getElementById('loginPage');
            const sp = document.getElementById('signupPage');
            if (lp) { lp.style.display = 'flex'; lp.classList.add('active'); }
            if (sp) { sp.style.display = 'none';  sp.classList.remove('active'); }
            clearAuthErrors();
        }

        function logout() {
            window._ssCurrentUser = null;
            window._sbToken = null;
            window._sbUserId = null;
            try { localStorage.removeItem('sb_session'); } catch(e) {}
            document.querySelectorAll('.feed-page,.progress-page,.groups-page,.profile-page').forEach(p => p.classList.remove('active'));
            showSignup();
        }

        function showAuthError(formId, msg) {
            const el = document.getElementById(formId + 'Error');
            if (el) { el.textContent = msg; el.style.display = 'block'; }
        }

        function clearAuthErrors() {
            document.querySelectorAll('.auth-error').forEach(el => { el.textContent = ''; el.style.display = 'none'; });
        }

        // ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function loadProfileForUser(user) {
            const el = id => document.getElementById(id);
            if (el('profileName'))     el('profileName').textContent    = user.full_name || user.fullName || '';
            if (el('profileUsername')) el('profileUsername').textContent = '@' + user.username;
            if (el('profileBio'))      el('profileBio').textContent      = user.bio || 'No bio yet.';
            
            // Profile avatar - show photo if exists, otherwise initials
            const avatarEl = el('profileInitials');
            if (avatarEl) {
                if (user.avatar_url) {
                    avatarEl.innerHTML = `<img src="${user.avatar_url}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" alt="">`;
                } else {
                    avatarEl.textContent = user.initials || '';
                    avatarEl.style.background = 'linear-gradient(135deg,var(--primary),var(--accent))';
                }
            }
            
            if (el('profileFollowers')) el('profileFollowers').textContent = user.followers || 0;
            if (el('profileFollowing')) el('profileFollowing').textContent = user.following || 0;
            refreshProfileStats(user);
            refreshProfileWorkouts(user);
            refreshAchievements(user);
        }

        // ‚îÄ‚îÄ EDIT PROFILE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function openEditProfile() {
            const user = getCurrentUser();
            if (!user) return;
            
            document.getElementById('editFullName').value = user.full_name || '';
            document.getElementById('editUsername').value = user.username || '';
            document.getElementById('editBio').value = user.bio || '';
            document.getElementById('editProfileAvatarInitials').textContent = user.initials || '';
            
            const avatarImg = document.getElementById('editProfileAvatarImg');
            const removeBtn = document.getElementById('removeProfilePicBtn');
            if (user.avatar_url) {
                avatarImg.src = user.avatar_url;
                avatarImg.style.display = 'block';
                document.getElementById('editProfileAvatarInitials').style.display = 'none';
                removeBtn.style.display = 'block';
            } else {
                avatarImg.style.display = 'none';
                document.getElementById('editProfileAvatarInitials').style.display = 'flex';
                removeBtn.style.display = 'none';
            }
            
            document.getElementById('editProfileModal').classList.add('active');
        }

        function closeEditProfile() {
            document.getElementById('editProfileModal').classList.remove('active');
            document.getElementById('profilePicInput').value = '';
        }

        // Handle profile pic upload
        document.getElementById('profilePicInput')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('editProfileAvatarImg');
                img.src = e.target.result;
                img.style.display = 'block';
                document.getElementById('editProfileAvatarInitials').style.display = 'none';
                document.getElementById('removeProfilePicBtn').style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        function removeProfilePic() {
            document.getElementById('profilePicInput').value = '';
            document.getElementById('editProfileAvatarImg').style.display = 'none';
            document.getElementById('editProfileAvatarInitials').style.display = 'flex';
            document.getElementById('removeProfilePicBtn').style.display = 'none';
        }

        async function handleSaveProfile() {
            const fullName = document.getElementById('editFullName').value.trim();
            const username = document.getElementById('editUsername').value.trim().toLowerCase();
            const bio      = document.getElementById('editBio').value.trim();
            
            if (!fullName || !username) {
                alert('Full name and username are required.');
                return;
            }
            
            if (username.length < 3) {
                alert('Username must be at least 3 characters.');
                return;
            }
            
            try {
                const user = getCurrentUser();
                
                // Check if username changed and is taken
                if (username !== user.username) {
                    const taken = await sb(`profiles?username=eq.${username}&id=neq.${window._sbUserId}&select=id`);
                    if (taken && taken.length > 0) {
                        alert('That username is already taken.');
                        return;
                    }
                }
                
                // Handle profile pic
                let avatarUrl = user.avatar_url;
                const picInput = document.getElementById('profilePicInput');
                const img = document.getElementById('editProfileAvatarImg');
                
                if (picInput.files.length > 0) {
                    // New photo uploaded - convert to base64
                    avatarUrl = img.src;
                } else if (img.style.display === 'none') {
                    // Photo was removed
                    avatarUrl = null;
                }
                
                // Generate new initials if name changed
                const initials = fullName.split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 2);
                
                // Update profile in Supabase
                await sb(`profiles?id=eq.${window._sbUserId}`, {
                    method: 'PATCH',
                    body: { full_name: fullName, username, bio, initials, avatar_url: avatarUrl }
                });
                
                // Update local cache
                user.full_name = fullName;
                user.username = username;
                user.bio = bio;
                user.initials = initials;
                user.avatar_url = avatarUrl;
                setCurrentUser(user);
                
                // Refresh UI
                loadProfileForUser(user);
                
                closeEditProfile();
                
                // Reload feed to update avatar/name in posts
                await loadFeedFromSupabase();
                
            } catch(e) {
                alert('Error saving profile: ' + e.message);
            }
        }

        // ‚îÄ‚îÄ VIEW USER PROFILE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let viewingUserId = null;

        async function viewUserProfile(userId) {
            viewingUserId = userId;
            
            // Hide search results
            document.getElementById('userSearchResults').style.display = 'none';
            document.getElementById('userSearchInput').value = '';
            
            // Hide main pages, show user profile view
            document.querySelectorAll('.feed-page, .progress-page, .groups-page, .profile-page').forEach(p => p.classList.remove('active'));
            document.getElementById('userProfileView').style.display = 'block';
            
            try {
                // Load user data
                const users = await sb(`profiles?id=eq.${userId}&select=*`);
                const user = users[0];
                
                // Get follow counts
                const following = await sb(`follows?follower_id=eq.${userId}&select=following_id`);
                const followers = await sb(`follows?following_id=eq.${userId}&select=follower_id`);
                
                // Load workouts
                const workouts = await sb(`workouts?user_id=eq.${userId}&order=created_at.desc&limit=50&select=*,profiles(id,full_name,initials,username,avatar_url)`);
                
                // Update UI
                document.getElementById('viewUserName').textContent = user.full_name || 'Unknown';
                document.getElementById('viewUserUsername').textContent = '@' + (user.username || 'unknown');
                document.getElementById('viewUserBio').textContent = user.bio || 'No bio yet.';
                document.getElementById('viewUserWorkoutCount').textContent = workouts?.length || 0;
                document.getElementById('viewUserFollowers').textContent = followers?.length || 0;
                document.getElementById('viewUserFollowing').textContent = following?.length || 0;
                
                // Avatar
                const avatarEl = document.getElementById('viewUserAvatar');
                if (user.avatar_url) {
                    avatarEl.innerHTML = `<img src="${user.avatar_url}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" alt="">`;
                } else {
                    avatarEl.textContent = user.initials || '??';
                    avatarEl.style.background = 'linear-gradient(135deg,var(--primary),var(--accent))';
                }
                
                // Follow button
                const followBtn = document.getElementById('viewUserFollowBtn');
                const isFollowing = userFollowing.has(userId);
                followBtn.textContent = isFollowing ? 'Unfollow' : 'Follow';
                followBtn.style.background = isFollowing ? 'transparent' : 'var(--primary)';
                followBtn.style.border = isFollowing ? '2px solid #666' : 'none';
                followBtn.style.color = isFollowing ? '#999' : '#fff';
                
                // Load workouts
                const feed = document.getElementById('viewUserWorkoutFeed');
                if (!workouts || workouts.length === 0) {
                    feed.innerHTML = `<div style="text-align:center;padding:60px 20px;color:#999;">
                        <div style="font-size:48px;margin-bottom:15px;">üèãÔ∏è</div>
                        <h3 style="font-family:'Bebas Neue',cursive;font-size:28px;color:var(--primary);margin-bottom:10px;">No workouts yet</h3>
                        <p>This user hasn't logged any workouts.</p>
                    </div>`;
                } else {
                    feed.innerHTML = '';
                    const frag = document.createDocumentFragment();
                    workouts.forEach(w => frag.appendChild(buildWorkoutCard(w, w.profiles)));
                    feed.appendChild(frag);
                }
                
            } catch(e) {
                console.warn('Error loading user profile:', e.message);
                closeUserProfile();
            }
        }

        function closeUserProfile() {
            document.getElementById('userProfileView').style.display = 'none';
            document.querySelector('.feed-page').classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector('.nav-link[data-page="feed"]').classList.add('active');
            viewingUserId = null;
        }

        async function toggleFollowOnProfile() {
            if (!viewingUserId) return;
            const isFollowing = userFollowing.has(viewingUserId);
            
            if (isFollowing) {
                await unfollowUser(viewingUserId);
            } else {
                await followUser(viewingUserId);
            }
            
            // Update button
            const btn = document.getElementById('viewUserFollowBtn');
            const nowFollowing = userFollowing.has(viewingUserId);
            btn.textContent = nowFollowing ? 'Unfollow' : 'Follow';
            btn.style.background = nowFollowing ? 'transparent' : 'var(--primary)';
            btn.style.border = nowFollowing ? '2px solid #666' : 'none';
            btn.style.color = nowFollowing ? '#999' : '#fff';
            
            // Update follower count
            const followers = await sb(`follows?following_id=eq.${viewingUserId}&select=follower_id`);
            document.getElementById('viewUserFollowers').textContent = followers?.length || 0;
        }

        // ‚îÄ‚îÄ SESSION CHECK ON LOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        (async function init() {
            try {
                const stored = localStorage.getItem('sb_session');
                if (stored) {
                    const sess = JSON.parse(stored);
                    if (sess.expires_at > Date.now() / 1000) {
                        window._sbToken  = sess.access_token;
                        window._sbUserId = sess.user_id;
                        const profiles = await sb(`profiles?id=eq.${sess.user_id}&select=*`);
                        if (profiles && profiles[0]) {
                            // Always reload workouts fresh from Supabase
                            const workouts = await sb(`workouts?user_id=eq.${sess.user_id}&order=created_at.desc&select=*`);
                            profiles[0].workouts = workouts || [];
                            setCurrentUser(profiles[0]);
                            loadProfileForUser(profiles[0]);
                            await loadFeedFromSupabase();
                            navigateToFeed();
                            return;
                        }
                    }
                }
            } catch(e) { console.warn('Session restore failed:', e.message); }
            showSignup();
        })();

        // ‚îÄ‚îÄ PROFILE TAB SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function switchProfileTab(tabName) {
            document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.profile-tab').forEach(t => {
                if (t.getAttribute('onclick')?.includes(tabName)) t.classList.add('active');
            });
            document.querySelectorAll('.profile-tab-content').forEach(c => c.classList.remove('active'));
            const tc = document.getElementById(tabName + '-tab');
            if (tc) tc.classList.add('active');
            const u = getCurrentUser();
            if (!u) return;
            if (tabName === 'stats')        refreshProfileStats(u);
            if (tabName === 'workouts')     refreshProfileWorkouts(u);
            if (tabName === 'achievements') refreshAchievements(u);
        }

        function refreshProfileWorkouts(user) {
            const feed = document.getElementById('profileWorkoutFeed');
            if (!feed) return;
            const workouts = user.workouts || [];
            if (workouts.length === 0) {
                feed.innerHTML = `<div style="text-align:center; padding:60px 20px; color:#999;">
                    <div style="font-size:48px; margin-bottom:15px;">üèãÔ∏è</div>
                    <h3 style="font-family:'Bebas Neue',cursive; font-size:28px; color:var(--primary); margin-bottom:10px;">No Workouts Yet</h3>
                    <p>Hit the + button to log your first workout!</p>
                </div>`;
                return;
            }
            feed.innerHTML = workouts.map(w => {
                const exerciseListHTML = (w.exercises || []).map(ex =>
                    `<div class="exercise-item">
                        <span class="exercise-name">${ex.name}</span>
                        <span class="exercise-details">${ex.sets||'?'} √ó ${ex.reps||'?'}${ex.weight ? ' @ '+ex.weight+' lbs' : ''}</span>
                    </div>`).join('') || '<div class="exercise-item"><span class="exercise-name">No exercises recorded</span></div>';
                const captionHTML = w.caption ? `<p class="workout-caption">"${w.caption}"</p>` : '';
                const dateStr = new Date(w.created_at || w.date).toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });
                const displayName = user.full_name || user.fullName || user.username || 'You';
                return `<div class="activity-card">
                    <div class="activity-header">
                        <div class="user-avatar">${user.initials}</div>
                        <div class="activity-user-info">
                            <h3>${displayName}</h3>
                            <span class="activity-time">${dateStr}</span>
                        </div>
                    </div>
                    <h2 class="workout-title">${w.name.toUpperCase()}</h2>
                    ${captionHTML}
                    <div class="workout-details">
                        <button class="details-toggle" onclick="toggleDetails(this)">
                            <span>View Workout Details</span>
                            <span class="details-toggle-icon">‚ñº</span>
                        </button>
                        <div class="workout-details-content">
                            <div class="workout-stats">
                                <div class="workout-stat">
                                    <div class="workout-stat-value">${w.exercises?.length || 0}</div>
                                    <div class="workout-stat-label">Exercises</div>
                                </div>
                                <div class="workout-stat">
                                    <div class="workout-stat-value">${w.duration || '‚Äî'}</div>
                                    <div class="workout-stat-label">Minutes</div>
                                </div>
                            </div>
                            <div class="exercise-list">${exerciseListHTML}</div>
                        </div>
                    </div>
                    <div class="activity-actions">
                        <button class="action-btn" onclick="handleRespect(this)">
                            <span class="action-icon">üëä</span><span>0 Respect</span>
                        </button>
                        <button class="action-btn"><span class="action-icon">üí¨</span><span>0 Comments</span></button>
                        <button class="action-btn"><span class="action-icon">üî•</span><span>PR!</span></button>
                    </div>
                </div>`;
            }).join('');
        }

        function refreshAchievements(user) {
            const grid = document.getElementById('achievementsGrid');
            if (!grid) return;
            const workouts = user.workouts || [];
            const count = workouts.length;
            const totalMinutes = workouts.reduce((s, w) => s + (w.duration || 0), 0);

            // Define all achievements with earned condition
            const all = [
                { icon:'ü•á', title:'First Rep',         desc:'Log your first workout',          earned: count >= 1 },
                { icon:'üîü', title:'10 Workout Club',   desc:'Log 10 workouts',                 earned: count >= 10 },
                { icon:'üèÜ', title:'25 Workout Club',   desc:'Log 25 workouts',                 earned: count >= 25 },
                { icon:'üíØ', title:'100 Workout Club',  desc:'Log 100 workouts',                earned: count >= 100 },
                { icon:'‚è±Ô∏è', title:'Hour Grinder',      desc:'Log 60+ minutes in a workout',    earned: workouts.some(w => w.duration >= 60) },
                { icon:'üïê', title:'Time Warrior',      desc:'Log 1,000 total minutes',         earned: totalMinutes >= 1000 },
                { icon:'üí™', title:'Variety Pack',      desc:'Log 5 different exercise names',  earned: new Set(workouts.flatMap(w => (w.exercises||[]).map(e => e.name.toLowerCase()))).size >= 5 },
                { icon:'üî•', title:'On Fire',           desc:'Log 3 workouts in one week',      earned: hasWorkoutsInWeek(workouts, 3) },
                { icon:'‚ö°', title:'Consistent',        desc:'Log workouts 2 weeks in a row',   earned: hasWeeklyStreak(workouts, 2) },
                { icon:'ü¶æ', title:'Iron Habit',        desc:'Log workouts 4 weeks in a row',   earned: hasWeeklyStreak(workouts, 4) },
            ];

            const earned = all.filter(a => a.earned);
            const locked = all.filter(a => !a.earned);

            if (earned.length === 0 && locked.length > 0) {
                grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:40px 20px; color:#999;">
                    <div style="font-size:48px; margin-bottom:15px;">üéØ</div>
                    <h3 style="font-family:'Bebas Neue',cursive; font-size:28px; color:var(--primary); margin-bottom:10px;">No Achievements Yet</h3>
                    <p>Log workouts to start earning achievements!</p>
                </div>` + locked.map(a => lockedCard(a)).join('');
                return;
            }

            grid.innerHTML =
                (earned.length > 0 ? `<div style="grid-column:1/-1; font-family:'Bebas Neue',cursive; font-size:18px; letter-spacing:2px; color:var(--primary); padding:10px 0 5px;">EARNED (${earned.length})</div>` + earned.map(a => earnedCard(a)).join('') : '') +
                (locked.length > 0 ? `<div style="grid-column:1/-1; font-family:'Bebas Neue',cursive; font-size:18px; letter-spacing:2px; color:#555; padding:20px 0 5px;">LOCKED (${locked.length})</div>` + locked.map(a => lockedCard(a)).join('') : '');
        }

        function earnedCard(a) {
            return `<div class="achievement-card" style="border-color:var(--primary);">
                <div class="achievement-icon">${a.icon}</div>
                <div class="achievement-title">${a.title}</div>
                <div class="achievement-description">${a.desc}</div>
            </div>`;
        }

        function lockedCard(a) {
            return `<div class="achievement-card" style="opacity:0.35; filter:grayscale(1);">
                <div class="achievement-icon">üîí</div>
                <div class="achievement-title" style="color:#666;">${a.title}</div>
                <div class="achievement-description">${a.desc}</div>
            </div>`;
        }

        function hasWorkoutsInWeek(workouts, n) {
            const weeks = {};
            workouts.forEach(w => {
                const d = new Date(w.date);
                const key = `${d.getFullYear()}-W${Math.floor((d - new Date(d.getFullYear(),0,1)) / 604800000)}`;
                weeks[key] = (weeks[key] || 0) + 1;
            });
            return Object.values(weeks).some(v => v >= n);
        }

        function hasWeeklyStreak(workouts, weeks) {
            if (workouts.length === 0) return false;
            const weekNums = [...new Set(workouts.map(w => {
                const d = new Date(w.date);
                return `${d.getFullYear()}-W${Math.floor((d - new Date(d.getFullYear(),0,1)) / 604800000)}`;
            }))].sort();
            let streak = 1, best = 1;
            for (let i = 1; i < weekNums.length; i++) {
                const prev = weekNums[i-1].split('-W'), cur = weekNums[i].split('-W');
                const diff = (parseInt(cur[1]) - parseInt(prev[1])) + (parseInt(cur[0]) - parseInt(prev[0])) * 52;
                streak = diff === 1 ? streak + 1 : 1;
                best = Math.max(best, streak);
            }
            return best >= weeks;
        }

        // ‚îÄ‚îÄ SIGNUP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function handleSignup() {
            const fullName = document.getElementById('signupName').value.trim();
            const username = document.getElementById('signupUsername').value.trim().toLowerCase();
            const email    = document.getElementById('signupEmail').value.trim().toLowerCase();
            const password = document.getElementById('signupPassword').value;

            if (!fullName || !username || !email || !password) { showAuthError('signup','Please fill in all fields.'); return; }
            if (username.length < 3) { showAuthError('signup','Username must be at least 3 characters.'); return; }
            if (password.length < 6) { showAuthError('signup','Password must be at least 6 characters.'); return; }

            const btn = document.querySelector('#signupForm .auth-submit-btn');
            btn.textContent = 'Creating...'; btn.disabled = true;

            try {
                // Check username availability
                const taken = await sb(`profiles?username=eq.${username}&select=id`);
                if (taken && taken.length > 0) { showAuthError('signup','Username already taken.'); btn.textContent='Create Account'; btn.disabled=false; return; }

                const authData = await sbAuth('signup', email, password);

                // Supabase may require email confirmation ‚Äî handle both cases
                const userId = authData.user?.id || authData.session?.user?.id;
                const token  = authData.access_token || authData.session?.access_token;

                if (!userId) {
                    showAuthError('signup', 'Please check your email and confirm your account, then log in.');
                    btn.textContent = 'Create Account'; btn.disabled = false; return;
                }

                window._sbToken  = token;
                window._sbUserId = userId;
                if (token) saveSession({ access_token: token, user: { id: userId }, expires_at: authData.expires_at || (Date.now()/1000 + 3600) });

                const initials = fullName.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
                const profile = { id: userId, username, full_name: fullName, initials, bio: '', followers: 0, following: 0 };
                await sb('profiles', { method:'POST', body: profile });

                profile.workouts = [];
                setCurrentUser(profile);
                loadProfileForUser(profile);
                await loadFeedFromSupabase();
                navigateToFeed();
            } catch(err) {
                showAuthError('signup', err.message);
                btn.textContent = 'Create Account'; btn.disabled = false;
            }
        }

        // ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function handleLogin() {
            const identifier = document.getElementById('loginIdentifier').value.trim().toLowerCase();
            const password   = document.getElementById('loginPassword').value;

            if (!identifier || !password) { showAuthError('login','Please fill in all fields.'); return; }

            const btn = document.querySelector('#loginForm .auth-submit-btn');
            btn.textContent = 'Logging in...'; btn.disabled = true;

            try {
                // Allow login by username ‚Äî look up their email first
                let email = identifier;
                if (!identifier.includes('@')) {
                    const rows = await sb(`profiles?username=eq.${identifier}&select=id`);
                    if (!rows || rows.length === 0) { showAuthError('login','No account with that username.'); btn.textContent='Log In'; btn.disabled=false; return; }
                    // We need email ‚Äî prompt them to use email
                    showAuthError('login', 'Please log in with your email address (username login coming soon).');
                    btn.textContent='Log In'; btn.disabled=false; return;
                }

                const authData = await sbAuth('token?grant_type=password', email, password);
                window._sbToken  = authData.access_token;
                window._sbUserId = authData.user.id;
                saveSession(authData);

                // Load profile
                const profiles = await sb(`profiles?id=eq.${authData.user.id}&select=*`);
                let profile = profiles && profiles[0];

                // Profile might not exist yet (e.g. email confirmation was on during signup)
                if (!profile) {
                    profile = {
                        id: authData.user.id,
                        username: email.split('@')[0],
                        full_name: email.split('@')[0],
                        initials: email.slice(0,2).toUpperCase(),
                        bio: '', followers: 0, following: 0
                    };
                    await sb('profiles', { method: 'POST', body: profile });
                }

                const workouts = await sb(`workouts?user_id=eq.${authData.user.id}&order=created_at.desc&select=*`);
                profile.workouts = workouts || [];

                setCurrentUser(profile);
                loadProfileForUser(profile);
                await loadFeedFromSupabase();
                navigateToFeed();
            } catch(err) {
                showAuthError('login', err.message.includes('Invalid') ? 'Incorrect email or password.' : err.message);
                btn.textContent = 'Log In'; btn.disabled = false;
            }
        }

        // ‚îÄ‚îÄ FEED FROM SUPABASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // ‚îÄ‚îÄ FOLLOW SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let currentFeedTab = 'following';
        let userFollowing = new Set(); // set of user_ids we follow

        async function loadFollowing() {
            if (!window._sbUserId) return;
            try {
                const rows = await sb(`follows?follower_id=eq.${window._sbUserId}&select=following_id`);
                userFollowing = new Set((rows || []).map(r => r.following_id));
            } catch(e) { userFollowing = new Set(); }
        }

        async function followUser(targetUserId) {
            try {
                await sb('follows', { method: 'POST', body: { follower_id: window._sbUserId, following_id: targetUserId } });
                userFollowing.add(targetUserId);
                // Update follower/following counts in profile display
                refreshFollowCounts();
            } catch(e) { console.warn('Follow error:', e.message); }
        }

        async function unfollowUser(targetUserId) {
            try {
                await sb(`follows?follower_id=eq.${window._sbUserId}&following_id=eq.${targetUserId}`, { method: 'DELETE', prefer: 'return=minimal' });
                userFollowing.delete(targetUserId);
                refreshFollowCounts();
            } catch(e) { console.warn('Unfollow error:', e.message); }
        }

        async function refreshFollowCounts() {
            if (!window._sbUserId) return;
            try {
                const following = await sb(`follows?follower_id=eq.${window._sbUserId}&select=following_id`);
                const followers = await sb(`follows?following_id=eq.${window._sbUserId}&select=follower_id`);
                const fgEl = document.getElementById('profileFollowing');
                const frEl = document.getElementById('profileFollowers');
                if (fgEl) fgEl.textContent = (following||[]).length;
                if (frEl) frEl.textContent = (followers||[]).length;
                const user = getCurrentUser();
                if (user) { user.following = (following||[]).length; user.followers = (followers||[]).length; }
            } catch(e) {}
        }

        // ‚îÄ‚îÄ USER SEARCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let searchDebounce = null;
        function handleUserSearch(query) {
            const results = document.getElementById('userSearchResults');
            clearTimeout(searchDebounce);
            if (!query.trim()) { results.style.display = 'none'; return; }
            searchDebounce = setTimeout(async () => {
                try {
                    const q = query.trim().toLowerCase().replace(/^@/, '');
                    const users = await sb(`profiles?or=(full_name.ilike.*${q}*,username.ilike.*${q}*)&limit=8&select=id,full_name,username,initials,avatar_url`);
                    if (!users || users.length === 0) {
                        results.innerHTML = `<div style="padding:20px;color:#666;font-family:'Oswald',sans-serif;text-align:center;">No users found</div>`;
                        results.style.display = 'block'; return;
                    }
                    results.innerHTML = users.map(u => {
                        const isMe = u.id === window._sbUserId;
                        const isFollowing = userFollowing.has(u.id);
                        const avatarContent = u.avatar_url 
                            ? `<img src="${u.avatar_url}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" alt="">`
                            : (u.initials || '?');
                        return `<div onclick="viewUserProfile('${u.id}')" style="display:flex;align-items:center;gap:15px;padding:14px 18px;border-bottom:1px solid #333;cursor:pointer;transition:background 0.2s;" onmouseover="this.style.background='rgba(255,107,53,0.08)'" onmouseout="this.style.background='transparent'">
                            <div style="width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',cursive;font-size:18px;flex-shrink:0;overflow:hidden;">${avatarContent}</div>
                            <div style="flex:1;">
                                <div style="font-family:'Oswald',sans-serif;font-size:15px;font-weight:600;">${u.full_name}</div>
                                <div style="font-size:12px;color:var(--primary);font-family:'Roboto Mono',monospace;">@${u.username}</div>
                            </div>
                            ${isMe ? '<span style="color:#666;font-size:12px;font-family:\'Oswald\',sans-serif;text-transform:uppercase;">You</span>' : `<button onclick="event.stopPropagation();toggleFollow('${u.id}',this)" 
                                style="background:${isFollowing?'transparent':'var(--primary)'};border:2px solid var(--primary);color:${isFollowing?'var(--primary)':'#fff'};padding:7px 16px;font-family:'Oswald',sans-serif;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1px;cursor:pointer;transition:all 0.2s;flex-shrink:0;" data-uid="${u.id}">
                                ${isFollowing ? 'Unfollow' : 'Follow'}
                            </button>`}
                        </div>`;
                    }).join('');
                    results.style.display = 'block';
                } catch(e) { results.style.display = 'none'; }
            }, 280);
        }

        async function toggleFollow(targetId, btn) {
            const isFollowing = userFollowing.has(targetId);
            if (isFollowing) {
                await unfollowUser(targetId);
                btn.textContent = 'Follow';
                btn.style.background = 'var(--primary)';
                btn.style.color = '#fff';
            } else {
                await followUser(targetId);
                btn.textContent = 'Unfollow';
                btn.style.background = 'transparent';
                btn.style.color = 'var(--primary)';
            }
            // Refresh feed if on following tab
            if (currentFeedTab === 'following') await loadFeedFromSupabase();
        }

        // ‚îÄ‚îÄ FEED TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function switchFeedTab(tab, btn) {
            currentFeedTab = tab;
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            if (btn) btn.classList.add('active');
            await loadFeedFromSupabase();
        }

        // ‚îÄ‚îÄ FEED LOADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function loadFeedFromSupabase() {
            await loadFollowing(); // always sync follow state first
            const feed = document.getElementById('mainFeed');
            const emptyState = document.getElementById('feedEmptyState');
            const emptyMsg = document.getElementById('feedEmptyMsg');
            if (!feed) return;

            // Show loading state
            feed.querySelectorAll('.activity-card').forEach(c => c.remove());

            try {
                let workouts;

                if (currentFeedTab === 'following') {
                    if (userFollowing.size === 0) {
                        if (emptyState) {
                            emptyState.style.display = 'block';
                            if (emptyMsg) emptyMsg.innerHTML = `You're not following anyone yet.<br>Search for users above to follow them and see their workouts here.`;
                        }
                        return;
                    }
                    const ids = [...userFollowing].join(',');
                    workouts = await sb(`workouts?user_id=in.(${ids})&order=created_at.desc&limit=50&select=*,profiles(id,full_name,initials,username,avatar_url)`);

                } else if (currentFeedTab === 'mine') {
                    workouts = await sb(`workouts?user_id=eq.${window._sbUserId}&order=created_at.desc&limit=50&select=*,profiles(id,full_name,initials,username,avatar_url)`);

                } else {
                    // Everyone
                    workouts = await sb(`workouts?order=created_at.desc&limit=50&select=*,profiles(id,full_name,initials,username,avatar_url)`);
                }

                if (!workouts || workouts.length === 0) {
                    if (emptyState) {
                        emptyState.style.display = 'block';
                        if (emptyMsg) {
                            if (currentFeedTab === 'mine') emptyMsg.innerHTML = `You haven't logged any workouts yet.<br>Hit the <strong style="color:var(--primary)">+</strong> button to log your first!`;
                            else if (currentFeedTab === 'following') emptyMsg.innerHTML = `No workouts from people you follow yet.`;
                            else emptyMsg.innerHTML = `No workouts logged yet. Be the first!`;
                        }
                    }
                    return;
                }

                if (emptyState) emptyState.style.display = 'none';
                const frag = document.createDocumentFragment();
                workouts.forEach(w => frag.appendChild(buildWorkoutCard(w, w.profiles)));
                feed.insertBefore(frag, feed.firstChild);

            } catch(e) { console.warn('Feed load error:', e.message); }
        }

        function buildWorkoutCard(w, profile) {
            const name     = profile?.full_name || 'Unknown';
            const initials = profile?.initials  || '??';
            const avatarUrl = profile?.avatar_url;
            const userId   = profile?.id;
            const isMe     = userId === window._sbUserId;
            const isFollowing = userId && userFollowing.has(userId);
            const exercises = w.exercises || [];
            const photoHTML   = w.photo_url ? `<img src="${w.photo_url}" class="workout-photo" alt="">` : '';
            const captionHTML = w.caption   ? `<p class="workout-caption">"${w.caption}"</p>` : '';
            const exHTML = exercises.length
                ? exercises.map(ex=>`<div class="exercise-item"><span class="exercise-name">${ex.name}</span><span class="exercise-details">${ex.sets||'?'} √ó ${ex.reps||'?'}${ex.weight?' @ '+ex.weight+' lbs':''}</span></div>`).join('')
                : '<div class="exercise-item"><span class="exercise-name">No exercises recorded</span></div>';
            const dateStr = new Date(w.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});

            // Avatar - show photo if exists, else initials
            const avatarHTML = avatarUrl 
                ? `<img src="${avatarUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" alt="">`
                : initials;

            const followBtn = (!isMe && userId) ? `<button onclick="toggleFollowFromCard('${userId}',this)"
                style="margin-left:auto;background:${isFollowing?'transparent':'var(--primary)'};border:2px solid var(--primary);color:${isFollowing?'var(--primary)':'#fff'};padding:6px 14px;font-family:'Oswald',sans-serif;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;cursor:pointer;transition:all 0.2s;" data-uid="${userId}">
                ${isFollowing ? 'Following' : '+ Follow'}
            </button>` : '';

            const card = document.createElement('div');
            card.className = 'activity-card';
            card.innerHTML = `
                <div class="activity-header">
                    <div class="user-avatar" onclick="${!isMe && userId ? `viewUserProfile('${userId}')` : ''}" style="${!isMe && userId ? 'cursor:pointer;' : ''}">${avatarHTML}</div>
                    <div class="activity-user-info" onclick="${!isMe && userId ? `viewUserProfile('${userId}')` : ''}" style="${!isMe && userId ? 'cursor:pointer;' : ''}">
                        <h3>${name}</h3>
                        <span class="activity-time">${dateStr}</span>
                    </div>
                    ${followBtn}
                </div>
                <h2 class="workout-title">${w.name.toUpperCase()}</h2>
                ${photoHTML}${captionHTML}
                <div class="workout-details">
                    <button class="details-toggle" onclick="toggleDetails(this)">
                        <span>View Workout Details</span><span class="details-toggle-icon">‚ñº</span>
                    </button>
                    <div class="workout-details-content">
                        <div class="workout-stats">
                            <div class="workout-stat"><div class="workout-stat-value">${exercises.length}</div><div class="workout-stat-label">Exercises</div></div>
                            <div class="workout-stat"><div class="workout-stat-value">${w.duration||'‚Äî'}</div><div class="workout-stat-label">Minutes</div></div>
                        </div>
                        <div class="exercise-list">${exHTML}</div>
                    </div>
                </div>
                <div class="activity-actions">
                    <button class="action-btn" onclick="handleRespect(this)"><span class="action-icon">üëä</span><span>0 Respect</span></button>
                    <button class="action-btn"><span class="action-icon">üí¨</span><span>0 Comments</span></button>
                    <button class="action-btn"><span class="action-icon">üî•</span><span>PR!</span></button>
                </div>`;
            return card;
        }

        async function toggleFollowFromCard(targetId, btn) {
            const isFollowing = userFollowing.has(targetId);
            if (isFollowing) {
                await unfollowUser(targetId);
                btn.textContent = '+ Follow';
                btn.style.background = 'var(--primary)';
                btn.style.color = '#fff';
            } else {
                await followUser(targetId);
                btn.textContent = 'Following';
                btn.style.background = 'transparent';
                btn.style.color = 'var(--primary)';
            }
            if (currentFeedTab === 'following') await loadFeedFromSupabase();
        }

        // ‚îÄ‚îÄ NAVIGATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function navigateToFeed() {
            const sp = document.getElementById('signupPage');
            const lp = document.getElementById('loginPage');
            if (sp) { sp.classList.remove('active'); sp.style.display = 'none'; }
            if (lp) { lp.classList.remove('active'); lp.style.display = 'none'; }
            document.querySelectorAll('.feed-page,.progress-page,.groups-page,.profile-page').forEach(p => p.classList.remove('active'));
            const fp = document.querySelector('.feed-page');
            if (fp) fp.classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const feedLink = document.querySelector('.nav-link[data-page="feed"]');
            if (feedLink) feedLink.classList.add('active');
        }
    </script>


</body>
</html>
