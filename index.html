<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitShare - Track Your Strength</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Bebas+Neue&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --black: #0a0a0a;
            --white: #fafafa;
            --iron: #1a1a1a;
            --steel: #2a2a2a;
            --primary: #ff6b35;
            --primary-dark: #ff5722;
            --primary-light: #ff8c61;
            --accent: #ffb347;
            --highlight: #ffd89b;
            --sweat: #ff9966;
            --shadow: rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Oswald', sans-serif;
            background: var(--black);
            color: var(--white);
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, var(--iron) 1px, transparent 1px),
                linear-gradient(180deg, var(--iron) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            z-index: 0;
            animation: gridPulse 4s ease-in-out infinite;
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.15; }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            padding: 20px 0;
            border-bottom: 3px solid var(--primary);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-search-btn {
            background: transparent;
            border: 2px solid #333;
            color: var(--white);
            padding: 10px 18px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .header-search-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .logo {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 4px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
        }

        /* Bottom Navigation Bar */
        nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--iron);
            border-top: 2px solid var(--primary);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
            z-index: 3000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.5);
        }

        nav a {
            color: #999;
            text-decoration: none;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            flex: 1;
            max-width: 100px;
        }

        nav a .nav-icon {
            width: 24px;
            height: 24px;
            transition: all 0.3s ease;
            fill: currentColor;
        }

        nav a:hover {
            color: var(--primary);
        }

        nav a.active {
            color: var(--primary);
        }
        nav a.active .nav-icon,
        nav a:hover .nav-icon {
            color: var(--primary);
        }

        nav a::after {
            display: none;
        }

        /* Center Log Button */
        .log-btn-container {
            position: relative;
            flex: 0 0 auto;
            margin: 0 10px;
        }

        .log-btn {
            background: var(--primary);
            color: var(--white);
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 4px solid var(--iron);
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            overflow: visible;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
            margin-top: -28px;
        }

        .log-btn span {
            position: relative;
            z-index: 1;
        }

        .log-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.6);
        }

        .log-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .log-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        /* Add bottom padding to main content to account for fixed nav */
        main {
            padding-bottom: 100px;
        }

        /* Hero Stats */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 30px 0;
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        @keyframes fadeInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .stat-card {
            background: linear-gradient(135deg, var(--steel), var(--iron));
            padding: 20px;
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 32px;
            color: var(--white);
            line-height: 1;
        }

        .stat-unit {
            font-size: 16px;
            color: var(--primary);
            margin-left: 5px;
        }

        /* Feed Section */
        .feed-section {
            margin: 60px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            animation: fadeInUp 1s ease-out 0.4s backwards;
        }

        .section-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .filter-tabs {
            display: flex;
            gap: 15px;
        }

        .filter-tab {
            background: transparent;
            color: #999;
            border: 2px solid #333;
            padding: 10px 25px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tab.active,
        .filter-tab:hover {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        /* Activity Cards */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .activity-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 0;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 1.2s ease-out backwards;
            transition: all 0.3s ease;
        }

        .activity-card:nth-child(1) { animation-delay: 0.5s; }
        .activity-card:nth-child(2) { animation-delay: 0.6s; }
        .activity-card:nth-child(3) { animation-delay: 0.7s; }
        .activity-card:nth-child(4) { animation-delay: 0.8s; }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .activity-card:hover::before {
            transform: scaleY(1);
        }

        .activity-card:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.3);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            font-weight: 700;
        }

        .activity-user-info h3 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .activity-time {
            font-size: 13px;
            color: #999;
            font-family: 'Roboto Mono', monospace;
        }

        .workout-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            letter-spacing: 2px;
            padding: 0 30px;
            margin: 20px 0 10px 0;
            color: var(--white);
        }

        .workout-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .workout-stat {
            text-align: center;
            padding: 12px;
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .workout-stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            color: var(--primary);
        }

        .workout-stat-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 3px;
        }

        .exercise-list {
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--iron);
            border-left: 3px solid var(--sweat);
            font-family: 'Roboto Mono', monospace;
        }

        .exercise-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--white);
        }

        .exercise-details {
            color: var(--sweat);
            font-size: 13px;
        }

        .activity-actions {
            display: flex;
            gap: 30px;
            padding: 20px 30px;
            border-top: 1px solid #333;
        }

        .action-btn {
            background: transparent;
            border: none;
            color: #999;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            color: var(--primary);
        }

        .action-icon {
            font-size: 18px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: flex-start;
            justify-content: center;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
            padding: 20px 0 100px 0;
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--steel);
            padding: 40px;
            width: 90%;
            max-width: 700px;
            border: 2px solid var(--primary);
            position: relative;
            animation: slideUp 0.4s ease-out;
            margin: auto;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 30px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .modal h2 {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 3px;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            color: #ccc;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            background: var(--iron);
            border: 2px solid #333;
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .exercise-inputs {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .add-exercise-btn {
            background: transparent;
            color: var(--sweat);
            border: 2px dashed var(--sweat);
            padding: 12px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-exercise-btn:hover {
            background: var(--sweat);
            color: var(--black);
        }

        .submit-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 18px 50px;
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.02);
        }

        /* Photo Upload Styling */
        .photo-upload-zone {
            border: 2px dashed rgba(255, 107, 53, 0.3);
            padding: 30px;
            text-align: center;
            background: rgba(255, 107, 53, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .photo-upload-zone:hover {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .photo-upload-zone.has-image {
            padding: 0;
            border-style: solid;
        }

        .upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .upload-text {
            color: #999;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #photoInput {
            display: none;
        }

        .preview-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            display: none;
        }

        .preview-image.active {
            display: block;
        }

        .remove-photo {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            color: var(--white);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .remove-photo.active {
            display: flex;
        }

        .remove-photo:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* Workout Photo in Activity Cards */
        .workout-photo {
            width: 100%;
            height: 450px;
            object-fit: cover;
            margin: 0;
            border: none;
        }

        .workout-caption {
            font-size: 18px;
            line-height: 1.6;
            color: #fff;
            padding: 20px 30px;
            font-style: normal;
            font-weight: 400;
        }

        /* Workout Details Section */
        .workout-details {
            padding: 25px 30px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid #333;
        }

        .details-toggle {
            background: transparent;
            border: none;
            color: var(--primary);
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            transition: color 0.3s ease;
        }

        .details-toggle:hover {
            color: var(--primary-light);
        }

        .details-toggle-icon {
            transition: transform 0.3s ease;
        }

        .details-toggle.active .details-toggle-icon {
            transform: rotate(180deg);
        }

        .workout-details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .workout-details-content.active {
            max-height: 1000px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .workout-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 32px;
            }

            nav a {
                font-size: 10px;
                padding: 5px 8px;
                max-width: 80px;
            }

            nav a .nav-icon {
                width: 20px;
                height: 20px;
            }

            .log-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                margin-top: -25px;
            }

            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 28px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }

            .workout-stats {
                grid-template-columns: 1fr;
            }

            .exercise-inputs {
                grid-template-columns: 1fr;
            }
        }

        /* Progress Page Styles */
        .progress-page {
            display: none;
        }

        .progress-page.active {
            display: block;
        }

        .feed-page.active {
            display: block;
        }

        .feed-page {
            display: none;
        }

        .progress-header {
            margin: 60px 0 40px 0;
            animation: fadeInUp 0.6s ease-out;
        }

        .progress-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 48px;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .progress-subtitle {
            color: #999;
            font-size: 16px;
            letter-spacing: 1px;
        }

        .exercise-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        .exercise-btn {
            background: var(--steel);
            border: 2px solid #333;
            color: var(--white);
            padding: 20px;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .exercise-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .exercise-btn:hover::before,
        .exercise-btn.active::before {
            transform: scaleY(1);
        }

        .exercise-btn:hover,
        .exercise-btn.active {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .chart-container {
            background: var(--steel);
            border: 1px solid #333;
            padding: 40px;
            margin-bottom: 30px;
            animation: fadeInUp 1s ease-out 0.4s backwards;
        }

        .chart-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 32px;
            letter-spacing: 2px;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .chart-wrapper {
            position: relative;
            height: 450px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
        }

        .chart-canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .pr-badge {
            display: inline-block;
            background: var(--primary);
            color: var(--white);
            padding: 5px 12px;
            font-size: 12px;
            font-weight: 700;
            border-radius: 3px;
            margin-left: 10px;
            letter-spacing: 1px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .stat-box {
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
            padding: 20px;
            text-align: center;
        }

        .stat-box-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-box-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 36px;
            color: var(--primary);
        }

        .workout-history {
            margin-top: 40px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table thead {
            background: rgba(0, 0, 0, 0.3);
        }

        .history-table th {
            padding: 15px;
            text-align: left;
            font-family: 'Oswald', sans-serif;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .history-table td {
            padding: 15px;
            border-bottom: 1px solid #333;
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
        }

        .history-table tbody tr {
            transition: background 0.3s ease;
        }

        .history-table tbody tr:hover {
            background: rgba(255, 107, 53, 0.05);
        }

        .trend-up {
            color: #4ade80;
        }

        .trend-down {
            color: #f87171;
        }

        .trend-neutral {
            color: #999;
        }

        /* Groups Page Styles */
        .groups-page {
            display: none;
        }

        .groups-page.active {
            display: block;
        }

        .groups-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 60px 0 40px 0;
            animation: fadeInUp 0.6s ease-out;
        }

        .create-group-btn {
            background: var(--primary);
            color: var(--white);
            padding: 15px 35px;
            border: none;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .create-group-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .group-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .group-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .group-header-banner {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 30px;
            position: relative;
        }

        .group-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            letter-spacing: 2px;
            color: var(--white);
            margin-bottom: 5px;
        }

        .group-members-count {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            font-family: 'Roboto Mono', monospace;
        }

        .group-body {
            padding: 25px;
        }

        .group-description {
            color: #ccc;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .group-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .group-stat {
            text-align: center;
            padding: 12px;
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .group-stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            color: var(--primary);
        }

        .group-stat-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .view-group-btn {
            width: 100%;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 12px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-group-btn:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* Group Detail View */
        .group-detail {
            display: none;
        }

        .group-detail.active {
            display: block;
        }

        .group-detail-header {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 40px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out;
        }

        .back-to-groups {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease;
        }

        .back-to-groups:hover {
            color: var(--white);
        }

        .group-detail-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 48px;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .group-detail-info {
            display: flex;
            gap: 30px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .post-workout-btn {
            background: var(--white);
            color: var(--primary);
            padding: 15px 40px;
            border: none;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .post-workout-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
        }

        .group-workout-feed {
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        .group-workout-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 0;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .group-workout-card:hover {
            border-color: var(--primary);
        }

        .workout-posted-by {
            padding: 20px 30px;
            background: rgba(255, 107, 53, 0.1);
            border-bottom: 2px solid var(--primary);
        }

        .posted-by-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .posted-by-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            color: var(--primary);
        }

        .workout-challenge-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            letter-spacing: 2px;
            padding: 20px 30px 10px 30px;
        }

        .workout-challenge-description {
            padding: 0 30px 20px 30px;
            color: #ccc;
            font-size: 15px;
            line-height: 1.6;
        }

        .workout-challenge-exercises {
            padding: 0 30px 20px 30px;
        }

        .completions-section {
            padding: 25px 30px;
            background: rgba(0, 0, 0, 0.2);
            border-top: 1px solid #333;
        }

        .completions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .completions-title {
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #999;
        }

        .complete-workout-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 10px 25px;
            font-family: 'Oswald', sans-serif;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .complete-workout-btn:hover {
            background: var(--primary-dark);
        }

        .complete-workout-btn.completed {
            background: #4ade80;
        }

        .completions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .completion-item {
            background: var(--iron);
            padding: 15px;
            border-left: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .completion-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 18px;
            flex-shrink: 0;
        }

        .completion-info {
            flex: 1;
        }

        .completion-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .completion-time {
            font-size: 11px;
            color: #999;
            font-family: 'Roboto Mono', monospace;
        }

        .completion-status {
            font-size: 20px;
        }

        .completion-photo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border: 2px solid var(--primary);
            cursor: pointer;
        }

        /* Auth Pages (Login/Signup) */
        .auth-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - 80px);
            background: var(--black);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        .auth-page.active {
            display: flex;
        }

        .auth-container {
            max-width: 450px;
            width: 90%;
            animation: slideUp 0.5s ease-out;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-logo-text {
            font-family: 'Bebas Neue', cursive;
            font-size: 56px;
            letter-spacing: 4px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-tagline {
            color: #999;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 10px;
        }

        .auth-form {
            background: var(--steel);
            padding: 40px;
            border: 2px solid var(--primary);
        }

        .auth-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 32px;
            letter-spacing: 2px;
            color: var(--primary);
            margin-bottom: 30px;
        }

        .auth-input-group {
            margin-bottom: 20px;
        }

        .auth-input-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            color: #ccc;
        }

        .auth-input-group input {
            width: 100%;
            padding: 15px;
            background: var(--iron);
            border: 2px solid #333;
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .auth-input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .auth-submit-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 18px;
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .auth-submit-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .auth-switch {
            text-align: center;
            margin-top: 25px;
            color: #999;
            font-size: 14px;
        }

        .auth-switch-link {
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .auth-switch-link:hover {
            color: var(--primary-light);
        }

        /* Profile Page */
        .profile-page {
            display: none;
        }

        .profile-page.active {
            display: block;
        }

        .profile-header {
            background: linear-gradient(135deg, var(--steel), var(--iron));
            padding: 40px;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--primary);
            animation: fadeInUp 0.6s ease-out;
        }

        .profile-top {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 48px;
            border: 4px solid var(--primary);
            flex-shrink: 0;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 42px;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .profile-username {
            color: var(--primary);
            font-size: 18px;
            font-family: 'Roboto Mono', monospace;
            margin-bottom: 15px;
        }

        .profile-bio {
            color: #ccc;
            line-height: 1.6;
            font-size: 15px;
            margin-bottom: 20px;
        }

        .profile-stats-row {
            display: flex;
            gap: 30px;
        }

        .profile-stat-item {
            text-align: center;
        }

        .profile-stat-number {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            color: var(--primary);
        }

        .profile-stat-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .edit-profile-btn, .logout-btn {
            padding: 12px 30px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .edit-profile-btn {
            background: var(--primary);
            color: var(--white);
        }

        .edit-profile-btn:hover {
            background: var(--primary-dark);
        }

        .logout-btn {
            background: transparent;
            border: 2px solid #666;
            color: #999;
        }

        .logout-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .profile-tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #333;
            margin-bottom: 30px;
        }

        .profile-tab {
            background: transparent;
            border: none;
            color: #999;
            padding: 15px 30px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .profile-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .profile-tab:hover {
            color: var(--primary);
        }

        .profile-content {
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        .profile-tab-content {
            display: none;
        }

        .profile-tab-content.active {
            display: block;
        }

        .profile-achievements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .achievement-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .achievement-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .achievement-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .achievement-description {
            font-size: 13px;
            color: #999;
        }

        .no-auth-message {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-auth-message h2 {
            font-family: 'Bebas Neue', cursive;
            font-size: 36px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .login-prompt-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 15px 40px;
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .login-prompt-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        /* ── SEARCH PAGE ─────────────────────────────────────────────── */
        .search-page { display: none; }
        .search-page.active { display: block; }

        .search-header {
            margin: 40px 0 30px 0;
            animation: fadeInUp 0.6s ease-out;
        }

        .search-bar-wrapper {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 18px 20px 18px 55px;
            background: var(--steel);
            border: 2px solid #333;
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            letter-spacing: 1px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-input::placeholder { color: #555; }

        .search-icon-label {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            pointer-events: none;
        }

        .search-results-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            letter-spacing: 2px;
            color: #999;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .people-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .person-card {
            background: var(--steel);
            border: 1px solid #333;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .person-card:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .person-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 22px;
            flex-shrink: 0;
        }

        .person-info { flex: 1; min-width: 0; }

        .person-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 22px;
            letter-spacing: 1px;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .person-username {
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .person-bio {
            font-size: 13px;
            color: #999;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .person-stats {
            display: flex;
            gap: 20px;
            margin-right: 20px;
        }

        .person-stat {
            text-align: center;
        }

        .person-stat-num {
            font-family: 'Bebas Neue', cursive;
            font-size: 20px;
            color: var(--white);
        }

        .person-stat-lbl {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .follow-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 10px 24px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .follow-btn:hover { background: var(--primary-dark); }

        .follow-btn.following {
            background: transparent;
            border: 2px solid #555;
            color: #999;
        }

        .follow-btn.following:hover {
            border-color: #f87171;
            color: #f87171;
        }

        .search-empty {
            text-align: center;
            padding: 60px 20px;
            color: #555;
        }

        .search-empty-icon { font-size: 56px; margin-bottom: 20px; }

        .search-empty h3 {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            color: #444;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        /* ── PROGRESS PAGE – real data styles ───────────────────────── */
        .no-data-notice {
            text-align: center;
            padding: 60px 20px;
            color: #555;
            background: var(--steel);
            border: 1px dashed #333;
            margin-bottom: 30px;
        }

        .no-data-notice h3 {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            color: #666;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }


        /* ── POST TYPE SELECTOR ── */
        .post-type-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2500;
            align-items: flex-end;
            justify-content: center;
        }
        .post-type-overlay.active { display: flex; }
        .post-type-sheet {
            background: var(--iron);
            border-top: 2px solid var(--primary);
            width: 100%;
            max-width: 600px;
            padding: 30px 30px calc(30px + env(safe-area-inset-bottom));
            animation: slideUpSheet 0.3s ease-out;
        }
        @keyframes slideUpSheet {
            from { transform: translateY(100%); }
            to   { transform: translateY(0); }
        }
        .post-type-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 24px;
            letter-spacing: 2px;
            color: #999;
            margin-bottom: 20px;
            text-align: center;
        }
        .post-type-btn {
            width: 100%;
            background: var(--steel);
            border: 2px solid #333;
            color: var(--white);
            padding: 22px 25px;
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
            text-align: left;
        }
        .post-type-btn:hover { border-color: var(--primary); background: rgba(255,107,53,0.1); }
        .post-type-btn .pt-icon { font-size: 28px; }
        .post-type-btn .pt-text { flex: 1; }
        .post-type-btn .pt-label { display: block; font-size: 18px; }
        .post-type-btn .pt-sub { display: block; font-size: 12px; color: #999; font-weight: 400; margin-top: 2px; text-transform: none; letter-spacing: 0; }
        .post-type-cancel {
            width: 100%;
            background: transparent;
            border: none;
            color: #666;
            padding: 15px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            margin-top: 5px;
        }

        /* ── MULTI-STEP MODAL ── */
        .modal-step { display: none; }
        .modal-step.active { display: block; }
        .modal-step-indicator {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 25px;
        }
        .step-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: #333;
            transition: all 0.3s;
        }
        .step-dot.active { background: var(--primary); width: 24px; border-radius: 4px; }
        .modal-step-nav {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }
        .btn-back {
            background: transparent;
            border: 2px solid #333;
            color: #999;
            padding: 14px 25px;
            font-family: 'Oswald', sans-serif;
            font-size: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-back:hover { border-color: #666; color: var(--white); }
        .btn-next {
            flex: 1;
            background: var(--primary);
            border: none;
            color: var(--white);
            padding: 14px 25px;
            font-family: 'Oswald', sans-serif;
            font-size: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-next:hover { background: var(--primary-dark); }

        /* ── POST CARD REDESIGN ── */
        .post-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0 12px;
            color: #666;
            font-size: 12px;
            font-family: 'Roboto Mono', monospace;
        }
        .post-meta-dot { color: #444; }
        .post-exercises-preview {
            padding: 0 30px 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .post-ex-chip {
            background: rgba(255,107,53,0.08);
            border: 1px solid rgba(255,107,53,0.2);
            color: #ccc;
            padding: 4px 10px;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            border-radius: 2px;
        }
        .view-workout-btn {
            background: transparent;
            border: none;
            color: var(--primary);
            font-family: 'Oswald', sans-serif;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            padding: 0 30px 20px;
            display: block;
        }
        .view-workout-btn:hover { color: var(--primary-light); }

        /* ── FULL WORKOUT DRAWER ── */
        .workout-drawer {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 2500;
            background: rgba(0,0,0,0.9);
            align-items: flex-end;
            justify-content: center;
        }
        .workout-drawer.active { display: flex; }
        .workout-drawer-sheet {
            background: var(--steel);
            border-top: 2px solid var(--primary);
            width: 100%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 30px 30px calc(30px + env(safe-area-inset-bottom));
            animation: slideUpSheet 0.3s ease-out;
        }
        .drawer-close {
            float: right;
            background: transparent;
            border: none;
            color: #999;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
            margin-top: -5px;
        }
        .drawer-close:hover { color: var(--white); }
        .drawer-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            letter-spacing: 2px;
            margin-bottom: 20px;
            padding-right: 40px;
        }

        /* ── LIKES ── */
        .action-btn.liked { color: var(--primary); }
        .action-btn.liked .like-icon { transform: scale(1.2); display: inline-block; }

        /* ── COMMENTS ── */
        .comments-section {
            border-top: 1px solid #222;
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.3s ease;
        }
        .comments-section.open {
            max-height: 600px;
            padding: 15px 0 0;
        }
        .comment-list { padding: 0 30px; margin-bottom: 12px; }
        .comment-item {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        .comment-avatar {
            width: 30px; height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex; align-items: center; justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 13px;
            flex-shrink: 0;
        }
        .comment-avatar img {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        .comment-bubble {
            background: var(--iron);
            padding: 8px 12px;
            flex: 1;
        }
        .comment-author {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 3px;
        }
        .comment-text {
            font-size: 14px;
            color: #ccc;
            font-family: 'Roboto Mono', monospace;
            line-height: 1.4;
        }
        .comment-input-row {
            display: flex;
            gap: 10px;
            padding: 12px 30px 20px;
            border-top: 1px solid #222;
            align-items: center;
        }
        .comment-input-avatar {
            width: 32px; height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex; align-items: center; justify-content: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 13px;
            flex-shrink: 0;
            overflow: hidden;
        }
        .comment-input-avatar img {
            width: 100%; height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        .comment-input {
            flex: 1;
            background: var(--iron);
            border: 1px solid #333;
            color: var(--white);
            padding: 10px 14px;
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }
        .comment-input:focus { border-color: var(--primary); }
        .comment-send {
            background: var(--primary);
            border: none;
            color: var(--white);
            padding: 10px 16px;
            font-family: 'Oswald', sans-serif;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            transition: background 0.2s;
        }
        .comment-send:hover { background: var(--primary-dark); }

        /* ── PROFILE PHOTO ── */
        .user-avatar, .profile-avatar-large {
            overflow: hidden;
            position: relative;
        }
        .user-avatar img, .profile-avatar-large img {
            width: 100%; height: 100%;
            object-fit: cover;
            border-radius: 50%;
            position: absolute;
            inset: 0;
        }
        .profile-photo-upload {
            position: absolute;
            bottom: 0; right: 0;
            width: 36px; height: 36px;
            background: var(--primary);
            border-radius: 50%;
            border: 3px solid var(--steel);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-size: 16px;
            z-index: 2;
        }

    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">SPLITSHARE</div>
                <button class="header-search-btn" onclick="navigateToPage('search')">🔍 Find People</button>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Hero Stats -->
        <!-- Feed Page -->
        <div class="feed-page active">
            <!-- Feed Section -->
        <section class="feed-section">
            <div class="section-header">
                <h2 class="section-title">Activity Feed</h2>
                <div class="filter-tabs">
                    <button class="filter-tab active">Following</button>
                    <button class="filter-tab">Everyone</button>
                    <button class="filter-tab">My Workouts</button>
                </div>
            </div>

            <div class="activity-feed" id="mainFeed">
                <!-- Workouts load here from Supabase -->
            </div>
        </section>
        </div>
        <!-- End Feed Page -->

        <!-- Progress Page -->
        <div class="progress-page">
            <div class="progress-header">
                <h1 class="progress-title">Your Lift Progress</h1>
                <p class="progress-subtitle">Track your gains and crush your PRs</p>
            </div>

            <div class="exercise-selector">
                <button class="exercise-btn active" data-exercise="bench">Bench Press</button>
                <button class="exercise-btn" data-exercise="squat">Squat</button>
                <button class="exercise-btn" data-exercise="deadlift">Deadlift</button>
                <button class="exercise-btn" data-exercise="ohp">Overhead Press</button>
            </div>

            <div class="chart-container">
                <h2 class="chart-title" id="chartTitle">Your Progress</h2>
                
                <div class="chart-wrapper">
                    <canvas id="progressChart" class="chart-canvas"></canvas>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-box-label">Current PR</div>
                        <div class="stat-box-value" id="currentPR">—</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-label">Total Increase</div>
                        <div class="stat-box-value" id="totalIncrease">—</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-label">Sessions</div>
                        <div class="stat-box-value" id="avgGain">0</div>
                    </div>
                </div>
            </div>

            <div class="workout-history">
                <h2 class="chart-title">Recent Workouts</h2>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Exercise</th>
                            <th>Weight</th>
                            <th>Sets x Reps</th>
                            <th>Volume</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody"></tbody>
                </table>
            </div>
        </div>
        <!-- End Progress Page -->

        <!-- My Groups Page -->
        <div class="groups-page">
            <div class="groups-header">
                <div>
                    <h1 class="progress-title">My Groups</h1>
                    <p class="progress-subtitle">Train together, achieve together</p>
                </div>
                <button class="create-group-btn" onclick="openCreateGroupModal()">+ Create Group</button>
            </div>

            <div class="groups-grid">
                <!-- Group Card 1 -->
                <div class="group-card" onclick="openGroup('morning-grind')">
                    <div class="group-header-banner">
                        <h3 class="group-name">Morning Grind Crew</h3>
                        <div class="group-members-count"> 12 members</div>
                    </div>
                    <div class="group-body">
                        <p class="group-description">Early morning lifters crushing it before work. 5 AM squad! </p>
                        <div class="group-stats">
                            <div class="group-stat">
                                <div class="group-stat-value">24</div>
                                <div class="group-stat-label">Workouts</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-value">89%</div>
                                <div class="group-stat-label">Completion</div>
                            </div>
                        </div>
                        <button class="view-group-btn">View Group</button>
                    </div>
                </div>

                <!-- Group Card 2 -->
                <div class="group-card" onclick="openGroup('powerlifting')">
                    <div class="group-header-banner">
                        <h3 class="group-name">Powerlifting Gang</h3>
                        <div class="group-members-count"> 8 members</div>
                    </div>
                    <div class="group-body">
                        <p class="group-description">Focused on the big three: squat, bench, deadlift. Let's get strong! </p>
                        <div class="group-stats">
                            <div class="group-stat">
                                <div class="group-stat-value">18</div>
                                <div class="group-stat-label">Workouts</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-value">92%</div>
                                <div class="group-stat-label">Completion</div>
                            </div>
                        </div>
                        <button class="view-group-btn">View Group</button>
                    </div>
                </div>

                <!-- Group Card 3 -->
                <div class="group-card" onclick="openGroup('summer-shred')">
                    <div class="group-header-banner">
                        <h3 class="group-name">Summer Shred</h3>
                        <div class="group-members-count"> 25 members</div>
                    </div>
                    <div class="group-body">
                        <p class="group-description">12-week program to get beach ready. High intensity, high accountability! </p>
                        <div class="group-stats">
                            <div class="group-stat">
                                <div class="group-stat-value">36</div>
                                <div class="group-stat-label">Workouts</div>
                            </div>
                            <div class="group-stat">
                                <div class="group-stat-value">76%</div>
                                <div class="group-stat-label">Completion</div>
                            </div>
                        </div>
                        <button class="view-group-btn">View Group</button>
                    </div>
                </div>
            </div>

            <!-- Group Detail View -->
            <div class="group-detail" id="groupDetail">
                <div class="group-detail-header">
                    <button class="back-to-groups" onclick="closeGroup()">â† Back to Groups</button>
                    <h2 class="group-detail-title" id="groupDetailTitle">Morning Grind Crew</h2>
                    <div class="group-detail-info">
                        <span> 12 members</span>
                        <span>&#128197; Created Jan 2026</span>
                        <span> Leader: Marcus King</span>
                    </div>
                    <button class="post-workout-btn" onclick="openPostWorkoutModal()">&#128221; Post New Workout Challenge</button>
                </div>

                <div class="group-workout-feed">
                    <!-- Workout Challenge 1 -->
                    <div class="group-workout-card">
                        <div class="workout-posted-by">
                            <div class="posted-by-label">Posted by Group Leader</div>
                            <div class="posted-by-name">Marcus King</div>
                        </div>
                        <h3 class="workout-challenge-title">Monday Push Day Challenge</h3>
                        <p class="workout-challenge-description">Let's crush this push day together! Focus on progressive overload - add 5 lbs from last week if you can. Post your completion photo or just check in when done! </p>
                        <div class="workout-challenge-exercises">
                            <div class="exercise-list">
                                <div class="exercise-item">
                                    <span class="exercise-name">Barbell Bench Press</span>
                                    <span class="exercise-details">4 x 8</span>
                                </div>
                                <div class="exercise-item">
                                    <span class="exercise-name">Incline Dumbbell Press</span>
                                    <span class="exercise-details">3 x 10</span>
                                </div>
                                <div class="exercise-item">
                                    <span class="exercise-name">Cable Flyes</span>
                                    <span class="exercise-details">3 x 12</span>
                                </div>
                                <div class="exercise-item">
                                    <span class="exercise-name">Overhead Press</span>
                                    <span class="exercise-details">3 x 8</span>
                                </div>
                                <div class="exercise-item">
                                    <span class="exercise-name">Tricep Pushdowns</span>
                                    <span class="exercise-details">3 x 15</span>
                                </div>
                            </div>
                        </div>
                        <div class="completions-section">
                            <div class="completions-header">
                                <div class="completions-title">Completions (8/12)</div>
                                <button class="complete-workout-btn" onclick="completeWorkout(this)">âœ“ Mark Complete</button>
                            </div>
                            <div class="completions-grid">
                                <div class="completion-item">
                                    <div class="completion-avatar">JR</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Jessica Rodriguez</div>
                                        <div class="completion-time">2 hours ago</div>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1574680096145-d05b474e2155?w=100&h=100&fit=crop" class="completion-photo" alt="Workout completion">
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">TC</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Tyler Chen</div>
                                        <div class="completion-time">3 hours ago</div>
                                    </div>
                                    <span class="completion-status">âœ…</span>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">SD</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Sarah Davis</div>
                                        <div class="completion-time">4 hours ago</div>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?w=100&h=100&fit=crop" class="completion-photo" alt="Workout completion">
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">MJ</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Mike Johnson</div>
                                        <div class="completion-time">5 hours ago</div>
                                    </div>
                                    <span class="completion-status">âœ…</span>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">AL</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Alex Lee</div>
                                        <div class="completion-time">6 hours ago</div>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=100&h=100&fit=crop" class="completion-photo" alt="Workout completion">
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">KB</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Kim Brown</div>
                                        <div class="completion-time">7 hours ago</div>
                                    </div>
                                    <span class="completion-status">âœ…</span>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">RP</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Ryan Park</div>
                                        <div class="completion-time">8 hours ago</div>
                                    </div>
                                    <span class="completion-status">âœ…</span>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">EN</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Emma Nelson</div>
                                        <div class="completion-time">9 hours ago</div>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1550345332-09e3ac987658?w=100&h=100&fit=crop" class="completion-photo" alt="Workout completion">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Workout Challenge 2 -->
                    <div class="group-workout-card">
                        <div class="workout-posted-by">
                            <div class="posted-by-label">Posted by Group Leader</div>
                            <div class="posted-by-name">Marcus King</div>
                        </div>
                        <h3 class="workout-challenge-title">Friday Leg Day </h3>
                        <p class="workout-challenge-description">End the week strong with a brutal leg session. Remember: legs don't grow from comfort!</p>
                        <div class="workout-challenge-exercises">
                            <div class="exercise-list">
                                <div class="exercise-item">
                                    <span class="exercise-name">Back Squat</span>
                                    <span class="exercise-details">5 x 5</span>
                                </div>
                                <div class="exercise-item">
                                    <span class="exercise-name">Romanian Deadlift</span>
                                    <span class="exercise-details">4 x 8</span>
                                </div>
                                <div class="exercise-item">
                                    <span class="exercise-name">Leg Press</span>
                                    <span class="exercise-details">3 x 12</span>
                                </div>
                                <div class="exercise-item">
                                    <span class="exercise-name">Walking Lunges</span>
                                    <span class="exercise-details">3 x 20</span>
                                </div>
                            </div>
                        </div>
                        <div class="completions-section">
                            <div class="completions-header">
                                <div class="completions-title">Completions (5/12)</div>
                                <button class="complete-workout-btn" onclick="completeWorkout(this)">âœ“ Mark Complete</button>
                            </div>
                            <div class="completions-grid">
                                <div class="completion-item">
                                    <div class="completion-avatar">TC</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Tyler Chen</div>
                                        <div class="completion-time">1 hour ago</div>
                                    </div>
                                    <span class="completion-status">âœ…</span>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">SD</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Sarah Davis</div>
                                        <div class="completion-time">2 hours ago</div>
                                    </div>
                                    <span class="completion-status">âœ…</span>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">AL</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Alex Lee</div>
                                        <div class="completion-time">3 hours ago</div>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1434682881908-b43d0467b798?w=100&h=100&fit=crop" class="completion-photo" alt="Workout completion">
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">MJ</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Mike Johnson</div>
                                        <div class="completion-time">4 hours ago</div>
                                    </div>
                                    <span class="completion-status">âœ…</span>
                                </div>
                                <div class="completion-item">
                                    <div class="completion-avatar">JR</div>
                                    <div class="completion-info">
                                        <div class="completion-name">Jessica Rodriguez</div>
                                        <div class="completion-time">5 hours ago</div>
                                    </div>
                                    <img src="https://images.unsplash.com/photo-1518611012118-696072aa579a?w=100&h=100&fit=crop" class="completion-photo" alt="Workout completion">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End My Groups Page -->

        <!-- Profile Page -->
        <div class="profile-page">
            <div class="profile-header">
                <div class="profile-top">
                    <div class="profile-avatar-large" id="profileInitials">MK</div>
                    <div class="profile-info">
                        <h1 class="profile-name" id="profileName">Marcus King</h1>
                        <div class="profile-username" id="profileUsername">@marcusking</div>
                        <p class="profile-bio" id="profileBio">Powerlifter | 5 AM Grind | Chasing 500lb deadlift </p>
                        <div class="profile-stats-row">
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="profileWorkoutCount">0</div>
                                <div class="profile-stat-label">Workouts</div>
                            </div>
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="profileFollowers">0</div>
                                <div class="profile-stat-label">Followers</div>
                            </div>
                            <div class="profile-stat-item">
                                <div class="profile-stat-number" id="profileFollowing">0</div>
                                <div class="profile-stat-label">Following</div>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="edit-profile-btn">Edit Profile</button>
                            <button class="logout-btn" onclick="logout()">Logout</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-tabs">
                <button class="profile-tab active" onclick="switchProfileTab('workouts')">Workouts</button>
                <button class="profile-tab" onclick="switchProfileTab('achievements')">Achievements</button>
                <button class="profile-tab" onclick="switchProfileTab('stats')">Stats</button>
            </div>

            <div class="profile-content">
                <!-- Workouts Tab -->
                <div class="profile-tab-content active" id="workouts-tab">
                    <div id="profileWorkoutFeed" class="activity-feed"></div>
                </div>

                <!-- Achievements Tab -->
                <div class="profile-tab-content" id="achievements-tab">
                    <div class="profile-achievements" id="achievementsGrid"></div>
                </div>

                <!-- Stats Tab -->
                <div class="profile-tab-content" id="stats-tab">
                    <div class="chart-container">
                        <h2 class="chart-title">My Workout Stats</h2>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-box-label">Total Workouts</div>
                                <div class="stat-box-value" id="statTotalWorkouts">0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-box-label">Total Exercises</div>
                                <div class="stat-box-value" id="statTotalExercises">0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-box-label">Total Minutes</div>
                                <div class="stat-box-value" id="statTotalMinutes">0</div>
                            </div>
                        </div>
                        <div id="recentWorkoutsList" style="margin-top:30px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Profile Page -->

        <!-- Search / Find People Page -->
        <div class="search-page" id="searchPage">
            <div class="search-header">
                <h1 class="progress-title">Find People</h1>
                <p class="progress-subtitle">Search for athletes to follow</p>
            </div>

            <div class="search-bar-wrapper">
                <span class="search-icon-label">🔍</span>
                <input class="search-input" id="peopleSearchInput" type="text"
                       placeholder="Search by name or username…"
                       oninput="handlePeopleSearch(this.value)">
            </div>

            <div id="searchResultsTitle" class="search-results-title" style="display:none"></div>
            <div class="people-grid" id="peopleGrid">
                <!-- Populated by JS -->
            </div>

            <div class="search-empty" id="searchEmpty" style="display:none">
                <div class="search-empty-icon">🏋️</div>
                <h3>No Athletes Found</h3>
                <p>Try a different name or username</p>
            </div>
        </div>
        <!-- End Search Page -->

    </main>

    <!-- Bottom Navigation -->
    <nav>
        <a href="#" class="nav-link active" data-page="feed">
            <svg class="nav-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9.5L12 3l9 6.5V20a1 1 0 01-1 1H5a1 1 0 01-1-1V9.5z" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linejoin="round"/>
                <path d="M9 21V12h6v9" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linejoin="round"/>
            </svg>
            <span>Feed</span>
        </a>
        <a href="#" class="nav-link" data-page="progress">
            <svg class="nav-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="14" width="3" height="7" rx="1" fill="currentColor"/>
                <rect x="9" y="9" width="3" height="12" rx="1" fill="currentColor"/>
                <rect x="15" y="5" width="3" height="16" rx="1" fill="currentColor"/>
                <path d="M3 7l5-4 4 3 5-5" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Progress</span>
        </a>
        <div class="log-btn-container">
            <button class="log-btn" id="logBtn">
                <span>+</span>
            </button>
        </div>
        <a href="#" class="nav-link" data-page="groups">
            <svg class="nav-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <circle cx="9" cy="7" r="3" stroke="currentColor" stroke-width="1.8" fill="none"/>
                <path d="M3 20c0-3.3 2.7-6 6-6s6 2.7 6 6" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/>
                <circle cx="17" cy="8" r="2.5" stroke="currentColor" stroke-width="1.6" fill="none"/>
                <path d="M21 20c0-2.8-1.8-5.1-4-5.8" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/>
            </svg>
            <span>Groups</span>
        </a>
        <a href="#" class="nav-link" data-page="profile">
            <svg class="nav-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="1.8" fill="none"/>
                <path d="M4 20c0-4.4 3.6-8 8-8s8 3.6 8 8" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round"/>
            </svg>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Post Type Selector Sheet -->
    <div class="post-type-overlay" id="postTypeOverlay" onclick="if(event.target===this)closePostType()">
        <div class="post-type-sheet">
            <div class="post-type-title">What are you posting?</div>
            <button class="post-type-btn" onclick="openWorkoutModal('personal')">
                <span class="pt-icon">&#127947;</span>
                <span class="pt-text">
                    <span class="pt-label">Personal Workout</span>
                    <span class="pt-sub">Log a workout to your profile and the public feed</span>
                </span>
                <span>&#8250;</span>
            </button>
            <button class="post-type-btn" onclick="openWorkoutModal('group')">
                <span class="pt-icon">&#128101;</span>
                <span class="pt-text">
                    <span class="pt-label">Post to Group</span>
                    <span class="pt-sub">Share a workout challenge with your group</span>
                </span>
                <span>&#8250;</span>
            </button>
            <button class="post-type-cancel" onclick="closePostType()">Cancel</button>
        </div>
    </div>

    <!-- Log Workout Modal (2-step) -->
    <div class="modal" id="workoutModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&#215;</button>
            <h2 id="modalTitle">Log Workout</h2>

            <!-- Step indicators -->
            <div class="modal-step-indicator">
                <div class="step-dot active" id="dot1"></div>
                <div class="step-dot" id="dot2"></div>
            </div>

            <!-- STEP 1: Workout info -->
            <div class="modal-step active" id="modalStep1">
                <div class="form-group">
                    <label>Workout Name</label>
                    <input id="workoutName" type="text" placeholder="e.g., PUSH DAY - CHEST &amp; TRICEPS">
                </div>
                <div class="form-group">
                    <label>Workout Type</label>
                    <select id="workoutType">
                        <option value="">Select type</option>
                        <option value="push">Push (Chest, Shoulders, Triceps)</option>
                        <option value="pull">Pull (Back, Biceps)</option>
                        <option value="legs">Legs</option>
                        <option value="upper">Upper Body</option>
                        <option value="lower">Lower Body</option>
                        <option value="full">Full Body</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input id="workoutDuration" type="number" placeholder="60">
                </div>
                <div class="form-group">
                    <label>Exercises</label>
                    <div id="exerciseContainer">
                        <div class="exercise-inputs">
                            <input type="text" placeholder="Exercise name">
                            <input type="number" placeholder="Sets">
                            <input type="number" placeholder="Reps">
                            <input type="number" placeholder="Weight (lbs)">
                        </div>
                    </div>
                    <button type="button" class="add-exercise-btn" onclick="addExercise()">+ Add Exercise</button>
                </div>
                <div class="modal-step-nav">
                    <button class="btn-next" onclick="goToStep2()">Next &rarr;</button>
                </div>
            </div>

            <!-- STEP 2: Photo & caption -->
            <div class="modal-step" id="modalStep2">
                <div class="form-group">
                    <label>Add Photo (Optional)</label>
                    <div class="photo-upload-zone" id="photoZone" onclick="document.getElementById('photoInput').click()">
                        <div class="upload-icon">&#128247;</div>
                        <div class="upload-text">Tap to upload workout photo</div>
                        <img id="previewImage" class="preview-image" alt="Workout preview">
                        <button type="button" class="remove-photo" id="removePhoto" onclick="event.stopPropagation();removeWorkoutPhoto()">&#215;</button>
                    </div>
                    <input type="file" id="photoInput" accept="image/*">
                </div>
                <div class="form-group">
                    <label>Caption (Optional)</label>
                    <textarea id="captionInput" rows="3" placeholder="Feeling strong today!"></textarea>
                </div>
                <div id="groupSelectWrap" style="display:none">
                    <div class="form-group">
                        <label>Select Group</label>
                        <select id="groupSelect">
                            <option value="">Choose a group...</option>
                            <option value="morning-grind">Morning Grind Crew</option>
                            <option value="powerlifting">Powerlifting Gang</option>
                            <option value="summer-shred">Summer Shred</option>
                        </select>
                    </div>
                </div>
                <div class="modal-step-nav">
                    <button class="btn-back" onclick="goToStep1()">&larr; Back</button>
                    <button class="btn-next" onclick="handleLogWorkout()">Post Workout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Workout Full Detail Drawer -->
    <div class="workout-drawer" id="workoutDrawer" onclick="if(event.target===this)closeDrawer()">
        <div class="workout-drawer-sheet">
            <button class="drawer-close" onclick="closeDrawer()">&#215;</button>
            <div class="drawer-title" id="drawerTitle">Workout Details</div>
            <div id="drawerContent"></div>
            <div class="comment-list" id="drawerComments"></div>
            <div class="comment-input-row">
                <div class="comment-input-avatar" id="drawerCommentAvatar">?</div>
                <input class="comment-input" id="drawerCommentInput" placeholder="Add a comment..." onkeydown="if(event.key==='Enter')submitComment()">
                <button class="comment-send" onclick="submitComment()">Post</button>
            </div>
        </div>
    </div>

    <!-- Signup Page -->
    <div class="auth-page" id="signupPage">
        <div class="auth-container">
            <div class="auth-logo">
                <div class="auth-logo-text">SPLITSHARE</div>
                <div class="auth-tagline">Track Your Strength</div>
            </div>
            <div class="auth-form">
                <h2 class="auth-title">Create Account</h2>
                <div class="auth-error" id="signupError" style="display:none; color:#ff6b35; font-size:14px; margin-bottom:15px; padding:10px; background:rgba(255,107,53,0.1); border-left:3px solid #ff6b35;"></div>
                <form id="signupForm" onsubmit="return false;">
                    <div class="auth-input-group">
                        <label>Full Name</label>
                        <input id="signupName" type="text" placeholder="Marcus King">
                    </div>
                    <div class="auth-input-group">
                        <label>Username</label>
                        <input id="signupUsername" type="text" placeholder="marcusking">
                    </div>
                    <div class="auth-input-group">
                        <label>Email</label>
                        <input id="signupEmail" type="email" placeholder="marcus@example.com">
                    </div>
                    <div class="auth-input-group">
                        <label>Password</label>
                        <input id="signupPassword" type="password" placeholder="Min. 6 characters">
                    </div>
                    <button type="button" class="auth-submit-btn" onclick="handleSignup()">Create Account</button>
                </form>
                <div class="auth-switch">
                    Already have an account? <span class="auth-switch-link" onclick="showLogin()">Log in</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div class="auth-page" id="loginPage">
        <div class="auth-container">
            <div class="auth-logo">
                <div class="auth-logo-text">SPLITSHARE</div>
                <div class="auth-tagline">Track Your Strength</div>
            </div>
            <div class="auth-form">
                <h2 class="auth-title">Welcome Back</h2>
                <div class="auth-error" id="loginError" style="display:none; color:#ff6b35; font-size:14px; margin-bottom:15px; padding:10px; background:rgba(255,107,53,0.1); border-left:3px solid #ff6b35;"></div>
                <form id="loginForm" onsubmit="return false;">
                    <div class="auth-input-group">
                        <label>Email Address</label>
                        <input id="loginIdentifier" type="email" placeholder="marcus@example.com">
                    </div>
                    <div class="auth-input-group">
                        <label>Password</label>
                        <input id="loginPassword" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="button" class="auth-submit-btn" onclick="handleLogin()">Log In</button>
                </form>
                <div class="auth-switch">
                    Don't have an account? <span class="auth-switch-link" onclick="showSignup()">Sign up</span>
                </div>
            </div>
        </div>
    </div>



    <script>
        console.log('=== SPLITSHARE v3.0 - FOLLOW SYSTEM SYNCED ===');
        
        // ── CONFIG ────────────────────────────────────────────────────────
        const SUPABASE_URL = 'https://nygqoszurqvvdtndpufo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55Z3Fvc3p1cnF2dmR0bmRwdWZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NzU5NDksImV4cCI6MjA4NjM1MTk0OX0.KSd3SPRK2RULFCikjS7WpAlf8YvBiZnwsyA3OT6dzPY';

        window._ssCurrentUser = null;
        window._sbToken       = null;
        window._sbUserId      = null;
        window._following     = new Set(JSON.parse(localStorage.getItem('ss_following') || '[]'));
        window._likedPosts    = new Set(JSON.parse(localStorage.getItem('ss_likes') || '[]'));
        window._exerciseMap   = {};
        window.progressChart  = null;
        window._activeDrawerWorkout = null;
        window._postType      = 'personal';

        // ── REST ──────────────────────────────────────────────────────────
        async function sb(path, opts) {
            opts = opts || {};
            const res = await fetch(SUPABASE_URL + '/rest/v1/' + path, {
                method: opts.method || 'GET',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': 'Bearer ' + (window._sbToken || SUPABASE_KEY),
                    'Content-Type': 'application/json',
                    'Prefer': opts.prefer || 'return=representation'
                },
                body: opts.body ? JSON.stringify(opts.body) : undefined
            });
            if (!res.ok) {
                const e = await res.json().catch(() => ({}));
                throw new Error(e.message || e.error_description || res.statusText);
            }
            return res.status === 204 ? null : res.json();
        }

        async function sbAuth(endpoint, email, password) {
            const res = await fetch(SUPABASE_URL + '/auth/v1/' + endpoint, {
                method: 'POST',
                headers: { 'apikey': SUPABASE_KEY, 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error_description || data.msg || 'Auth failed');
            return data;
        }

        function getCurrentUser()  { return window._ssCurrentUser; }
        function setCurrentUser(u) { window._ssCurrentUser = u; }
        function saveSession(data) {
            try { localStorage.setItem('sb_session', JSON.stringify({ access_token: data.access_token, user_id: data.user.id, expires_at: data.expires_at || (Date.now()/1000+3600) })); } catch(e) {}
        }
        function saveLikes()     { try { localStorage.setItem('ss_likes',     JSON.stringify(Array.from(window._likedPosts))); } catch(e) {} }
        function saveFollowing() { try { localStorage.setItem('ss_following', JSON.stringify(Array.from(window._following)));  } catch(e) {} }

        // ── NAVIGATION ────────────────────────────────────────────────────
        function showPage(page) {
            ['feed','progress','groups','profile'].forEach(p => {
                const el = document.querySelector('.' + p + '-page');
                if (el) el.classList.remove('active');
            });
            const sp = document.getElementById('searchPage');
            if (sp) sp.classList.remove('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const link = document.querySelector('.nav-link[data-page="' + page + '"]');
            if (link) link.classList.add('active');
            if (page === 'feed') {
                const fp = document.querySelector('.feed-page');
                if (fp) fp.classList.add('active');
            } else if (page === 'progress') {
                const pp = document.querySelector('.progress-page');
                if (pp) { pp.classList.add('active'); setTimeout(renderProgressPage, 100); }
            } else if (page === 'groups') {
                const gp = document.querySelector('.groups-page');
                if (gp) { gp.classList.add('active'); closeGroup(); }
            } else if (page === 'profile') {
                const prp = document.querySelector('.profile-page');
                if (prp) prp.classList.add('active');
            } else if (page === 'search') {
                if (sp) { sp.classList.add('active'); loadPeopleFeed(); }
            }
        }

        function navigateToPage(page) { showPage(page); }

        function navigateToFeed() {
            ['signupPage','loginPage'].forEach(id => {
                const el = document.getElementById(id);
                if (el) { el.classList.remove('active'); el.style.display = 'none'; }
            });
            showPage('feed');
            loadFeedFromSupabase();
        }

        console.log('Attaching nav listeners...');
        document.querySelectorAll('.nav-link').forEach(link => {
            console.log('  - Attached to:', link.dataset.page);
            link.addEventListener('click', e => { e.preventDefault(); showPage(link.dataset.page); });
        });
        console.log('Nav listeners attached!');

        // Attach log button listener
        const logBtn = document.getElementById('logBtn');
        if (logBtn) {
            logBtn.addEventListener('click', openModal);
            console.log('Log button listener attached!');
        } else {
            console.error('Log button not found!');
        }

        // ── POST TYPE / MODAL ─────────────────────────────────────────────
        function openModal() {
            console.log('openModal called');
            document.getElementById('postTypeOverlay').classList.add('active');
        }
        function closePostType() {
            document.getElementById('postTypeOverlay').classList.remove('active');
        }
        function openWorkoutModal(type) {
            window._postType = type;
            closePostType();
            document.getElementById('modalTitle').textContent = type === 'group' ? 'Post to Group' : 'Log Workout';
            document.getElementById('groupSelectWrap').style.display = type === 'group' ? 'block' : 'none';
            goToStep1();
            document.getElementById('workoutModal').classList.add('active');
        }
        function closeModal() {
            document.getElementById('workoutModal').classList.remove('active');
        }
        document.getElementById('workoutModal').addEventListener('click', e => { if (e.target === document.getElementById('workoutModal')) closeModal(); });

        function goToStep1() {
            document.getElementById('modalStep1').classList.add('active');
            document.getElementById('modalStep2').classList.remove('active');
            document.getElementById('dot1').classList.add('active');
            document.getElementById('dot2').classList.remove('active');
        }
        function goToStep2() {
            const name = document.getElementById('workoutName').value.trim();
            if (!name) { alert('Please enter a workout name.'); return; }
            document.getElementById('modalStep1').classList.remove('active');
            document.getElementById('modalStep2').classList.add('active');
            document.getElementById('dot1').classList.remove('active');
            document.getElementById('dot2').classList.add('active');
        }

        function addExercise() {
            const container = document.getElementById('exerciseContainer');
            const div = document.createElement('div');
            div.className = 'exercise-inputs';
            div.innerHTML = '<input type="text" placeholder="Exercise name"><input type="number" placeholder="Sets"><input type="number" placeholder="Reps"><input type="number" placeholder="Weight (lbs)">';
            container.appendChild(div);
        }

        // ── PHOTO UPLOAD ──────────────────────────────────────────────────
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('previewImage');
                const zone = document.getElementById('photoZone');
                img.src = e.target.result;
                img.classList.add('active');
                zone.classList.add('has-image');
                document.getElementById('removePhoto').classList.add('active');
                zone.querySelector('.upload-icon').style.display = 'none';
                zone.querySelector('.upload-text').style.display = 'none';
            };
            reader.readAsDataURL(file);
        });

        function removeWorkoutPhoto() {
            document.getElementById('photoInput').value = '';
            const img  = document.getElementById('previewImage');
            const zone = document.getElementById('photoZone');
            img.classList.remove('active');
            zone.classList.remove('has-image');
            document.getElementById('removePhoto').classList.remove('active');
            zone.querySelector('.upload-icon').style.display = 'block';
            zone.querySelector('.upload-text').style.display = 'block';
        }

        function resetWorkoutForm() {
            document.getElementById('workoutName').value = '';
            document.getElementById('workoutDuration').value = '';
            document.getElementById('captionInput').value = '';
            document.getElementById('workoutType').value = '';
            removeWorkoutPhoto();
            document.getElementById('exerciseContainer').innerHTML =
                '<div class="exercise-inputs"><input type="text" placeholder="Exercise name"><input type="number" placeholder="Sets"><input type="number" placeholder="Reps"><input type="number" placeholder="Weight (lbs)"></div>';
        }

        // ── LOG WORKOUT ───────────────────────────────────────────────────
        async function handleLogWorkout() {
            const workoutName = document.getElementById('workoutName').value.trim();
            const duration    = parseInt(document.getElementById('workoutDuration').value) || 0;
            const caption     = document.getElementById('captionInput').value.trim();
            const previewImg  = document.getElementById('previewImage');
            const photoSrc    = previewImg.classList.contains('active') ? previewImg.src : null;

            if (!workoutName) { alert('Please enter a workout name.'); goToStep1(); return; }

            const exercises = [];
            document.querySelectorAll('#exerciseContainer .exercise-inputs').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const name = inputs[0] ? inputs[0].value.trim() : '';
                if (name) exercises.push({ name, sets: inputs[1].value, reps: inputs[2].value, weight: inputs[3].value });
            });

            const user        = getCurrentUser();
            const displayName = user ? (user.full_name || user.fullName || user.username || 'You') : 'You';
            const initials    = user ? (user.initials || displayName.split(' ').map(x => x[0]||'').join('').toUpperCase().slice(0,2)) : '??';
            const avatarUrl   = user ? user.avatar_url : null;
            const now         = new Date().toISOString();

            if (user) {
                const record = { user_id: window._sbUserId, name: workoutName, duration, caption: caption||null, exercises, photo_url: photoSrc||null, created_at: now };
                try {
                    const saved = await sb('workouts', { method: 'POST', body: record });
                    if (!user.workouts) user.workouts = [];
                    user.workouts.unshift(Object.assign({}, record, { id: (saved && saved[0] ? saved[0].id : null) }));
                    setCurrentUser(user);
                    refreshProfileStats(user); refreshProfileWorkouts(user); refreshAchievements(user);
                } catch(e) { console.warn('Save failed:', e.message); }
            }

            // Build card and insert
            const card = buildWorkoutCardEl({ name: workoutName, duration, caption, exercises, photo_url: photoSrc, created_at: now, id: Date.now() }, { full_name: displayName, initials, avatar_url: avatarUrl });
            const feed = document.getElementById('mainFeed');
            if (feed) feed.insertBefore(card, feed.firstChild);

            resetWorkoutForm();
            closeModal();
            navigateToFeed();
        }

        // ── HELPERS ───────────────────────────────────────────────────────
        function avatarHTML(initials, avatarUrl, size) {
            size = size || 50;
            if (avatarUrl) {
                return '<img src="' + avatarUrl + '" alt="" style="width:' + size + 'px;height:' + size + 'px;border-radius:50%;object-fit:cover;">';
            }
            return '<span style="font-family:\'Bebas Neue\',cursive;font-size:' + Math.round(size*0.44) + 'px">' + (initials||'??') + '</span>';
        }

        function timeAgo(dateStr) {
            if (!dateStr) return 'Recently';
            const d    = new Date(dateStr);
            if (isNaN(d)) return 'Recently';
            const diff = Date.now() - d.getTime();
            const mins = Math.floor(diff/60000);
            if (mins < 1)   return 'Just now';
            if (mins < 60)  return mins + 'm ago';
            const hrs = Math.floor(mins/60);
            if (hrs < 24)   return hrs + 'h ago';
            const days = Math.floor(hrs/24);
            if (days < 7)   return days + 'd ago';
            return d.toLocaleDateString('en-US',{month:'short',day:'numeric'});
        }

        // ── BUILD POST CARD ───────────────────────────────────────────────
        function buildWorkoutCardEl(w, profile) {
            const name      = profile ? (profile.full_name || profile.username || 'Unknown') : 'Unknown';
            const initials  = profile ? (profile.initials || name.split(' ').map(x=>x[0]||'').join('').toUpperCase().slice(0,2)) : '??';
            const avatarUrl = profile ? profile.avatar_url : null;
            const exercises = Array.isArray(w.exercises) ? w.exercises : [];
            const wid       = w.id || ('w_' + Date.now() + Math.random());
            const liked     = window._likedPosts.has(String(wid));
            const timeStr   = timeAgo(w.created_at || w.date);

            // Only show first 3 exercise chips
            const chips = exercises.slice(0,3).map(ex =>
                '<span class="post-ex-chip">' + ex.name + '</span>'
            ).join('') + (exercises.length > 3 ? '<span class="post-ex-chip">+' + (exercises.length-3) + ' more</span>' : '');

            const card = document.createElement('div');
            card.className = 'activity-card';
            card.dataset.workoutId = wid;
            card.innerHTML =
                '<div class="activity-header">' +
                    '<div class="user-avatar">' + avatarHTML(initials, avatarUrl, 50) + '</div>' +
                    '<div class="activity-user-info">' +
                        '<h3>' + name + '</h3>' +
                        '<div class="post-meta">' +
                            '<span>' + timeStr + '</span>' +
                            (exercises.length ? '<span class="post-meta-dot">·</span><span>' + exercises.length + ' exercise' + (exercises.length>1?'s':'') + '</span>' : '') +
                            (w.duration ? '<span class="post-meta-dot">·</span><span>' + w.duration + ' min</span>' : '') +
                        '</div>' +
                    '</div>' +
                '</div>' +
                '<h2 class="workout-title">' + (w.name||'Untitled').toUpperCase() + '</h2>' +
                (w.photo_url ? '<img src="' + w.photo_url + '" class="workout-photo" alt="">' : '') +
                (w.caption   ? '<p class="workout-caption">&ldquo;' + w.caption + '&rdquo;</p>' : '') +
                (chips ? '<div class="post-exercises-preview">' + chips + '</div>' : '') +
                '<button class="view-workout-btn" onclick="openWorkoutDrawer(' + JSON.stringify(wid) + ')">View Full Workout &rarr;</button>' +
                '<div class="activity-actions">' +
                    '<button class="action-btn like-btn' + (liked?' liked':'') + '" data-wid="' + wid + '" onclick="handleLike(this)">' +
                        '<span class="like-icon">&#10084;</span> <span class="like-count">0 Likes</span>' +
                    '</button>' +
                    '<button class="action-btn" onclick="openWorkoutDrawer(' + JSON.stringify(wid) + ')">' +
                        '&#128172; <span class="comment-count">0 Comments</span>' +
                    '</button>' +
                '</div>' +
                '<div class="comments-section" id="comments_' + wid + '"></div>';

            // Store workout data on element for drawer
            card._workoutData = w;
            card._profileData = profile;
            return card;
        }

        // ── LIKES ─────────────────────────────────────────────────────────
        function handleLike(btn) {
            const wid = btn.dataset.wid;
            if (window._likedPosts.has(String(wid))) return; // already liked
            window._likedPosts.add(String(wid));
            saveLikes();
            btn.classList.add('liked');
            const countEl = btn.querySelector('.like-count');
            const cur = parseInt(countEl.textContent) || 0;
            countEl.textContent = (cur + 1) + ' Like' + (cur+1===1?'':'s');
        }

        // ── WORKOUT DRAWER ────────────────────────────────────────────────
        window._drawerWorkouts = {};

        function openWorkoutDrawer(wid) {
            const card    = document.querySelector('[data-workout-id="' + wid + '"]');
            const drawer  = document.getElementById('workoutDrawer');
            const content = document.getElementById('drawerContent');
            const title   = document.getElementById('drawerTitle');

            let w       = card ? card._workoutData : null;
            let profile = card ? card._profileData : null;
            if (!w) return;

            window._activeDrawerWorkout = wid;
            title.textContent = (w.name || 'Untitled').toUpperCase();

            const exercises = Array.isArray(w.exercises) ? w.exercises : [];
            const exRows = exercises.map(ex =>
                '<div class="exercise-item"><span class="exercise-name">' + ex.name + '</span>' +
                '<span class="exercise-details">' + (ex.sets||'?') + ' x ' + (ex.reps||'?') + (ex.weight ? ' @ '+ex.weight+' lbs':'') + '</span></div>'
            ).join('') || '<div class="exercise-item"><span>No exercises recorded</span></div>';

            content.innerHTML =
                '<div class="workout-stats" style="margin-bottom:20px;">' +
                    '<div class="workout-stat"><div class="workout-stat-value">' + exercises.length + '</div><div class="workout-stat-label">Exercises</div></div>' +
                    '<div class="workout-stat"><div class="workout-stat-value">' + (w.duration||'&mdash;') + '</div><div class="workout-stat-label">Minutes</div></div>' +
                '</div>' +
                '<div class="exercise-list">' + exRows + '</div>';

            // Load comments
            const stored = JSON.parse(localStorage.getItem('comments_' + wid) || '[]');
            renderDrawerComments(stored);

            // Set commenter avatar
            const user = getCurrentUser();
            const avatarEl = document.getElementById('drawerCommentAvatar');
            if (user && user.avatar_url) {
                avatarEl.innerHTML = '<img src="' + user.avatar_url + '" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">';
            } else {
                avatarEl.textContent = user ? (user.initials || '?') : '?';
            }

            drawer.classList.add('active');
        }

        function closeDrawer() {
            document.getElementById('workoutDrawer').classList.remove('active');
            window._activeDrawerWorkout = null;
        }

        function commentHTML(c) {
            const av = c.avatar_url
                ? '<img src="' + c.avatar_url + '" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">'
                : (c.initials || '?');
            return '<div class="comment-item">' +
                '<div class="comment-avatar">' + av + '</div>' +
                '<div class="comment-bubble">' +
                    '<div class="comment-author">' + (c.name || 'Anonymous') + '</div>' +
                    '<div class="comment-text">' + c.text + '</div>' +
                '</div></div>';
        }

        function renderDrawerComments(comments) {
            const list = document.getElementById('drawerComments');
            if (!comments.length) {
                list.innerHTML = '<p style="color:#555;font-size:13px;padding:10px 0 5px;">No comments yet. Be the first!</p>';
                return;
            }
            list.innerHTML = comments.map(commentHTML).join('');
        }

        function renderCardCommentPreview(wid) {
            const section = document.getElementById('comments_' + wid);
            if (!section) return;
            const all = JSON.parse(localStorage.getItem('comments_' + wid) || '[]');
            if (!all.length) { section.innerHTML = ''; return; }
            const preview = all.slice(-2); // show last 2
            const moreCount = all.length - 2;
            section.innerHTML =
                '<div style="padding:10px 30px 5px;border-top:1px solid #222;">' +
                    preview.map(commentHTML).join('') +
                    (moreCount > 0
                        ? '<button onclick="openWorkoutDrawer(\'' + wid + '\')" style="background:none;border:none;color:var(--primary);font-family:Oswald,sans-serif;font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:1px;cursor:pointer;padding:5px 0 10px;">View all ' + all.length + ' comments</button>'
                        : '<button onclick="openWorkoutDrawer(\'' + wid + '\')" style="background:none;border:none;color:#666;font-family:Oswald,sans-serif;font-size:12px;cursor:pointer;padding:5px 0 10px;text-transform:uppercase;letter-spacing:1px;">Add a comment...</button>') +
                '</div>';
        }

        function submitComment() {
            const wid   = window._activeDrawerWorkout;
            const input = document.getElementById('drawerCommentInput');
            const text  = input.value.trim();
            if (!text || !wid) return;
            const user    = getCurrentUser();
            const comment = {
                name:       user ? (user.full_name || user.fullName || user.username || 'Anonymous') : 'Anonymous',
                initials:   user ? (user.initials || '?') : '?',
                avatar_url: user ? user.avatar_url : null,
                text,
                ts: Date.now()
            };
            const key      = 'comments_' + wid;
            const existing = JSON.parse(localStorage.getItem(key) || '[]');
            existing.push(comment);
            localStorage.setItem(key, JSON.stringify(existing));
            renderDrawerComments(existing);
            renderCardCommentPreview(wid);
            input.value = '';
            const countEl = document.querySelector('[data-workout-id="' + wid + '"] .comment-count');
            if (countEl) countEl.textContent = existing.length + ' Comment' + (existing.length===1?'':'s');
        }

        // ── FEED ──────────────────────────────────────────────────────────
        async function loadFeedFromSupabase() {
            const feed = document.getElementById('mainFeed');
            if (!feed) return;
            try {
                const workouts = await sb('workouts?order=created_at.desc&limit=50&select=*,profiles(full_name,initials,username,avatar_url)');
                if (!workouts || !workouts.length) {
                    feed.innerHTML = '<div style="text-align:center;padding:60px 20px;color:#555;">' +
                        '<div style="font-size:64px;margin-bottom:20px;opacity:0.3">&#127947;</div>' +
                        '<h3 style="font-family:\'Bebas Neue\',cursive;font-size:32px;color:#444;letter-spacing:3px;margin-bottom:10px;">No Workouts Yet</h3>' +
                        '<p style="color:#555;font-size:14px;letter-spacing:1px;">Be the first to log a workout!</p></div>';
                    return;
                }
                feed.innerHTML = '';
                workouts.forEach(w => {
                    if (!w || !w.name) return;
                    const card = buildWorkoutCardEl(w, w.profiles);
                    feed.appendChild(card);
                    // Restore like counts
                    const wid     = w.id || w.created_at;
                    const comments = JSON.parse(localStorage.getItem('comments_' + wid) || '[]');
                    const countEl  = card.querySelector('.comment-count');
                    if (countEl && comments.length) countEl.textContent = comments.length + ' Comment' + (comments.length===1?'':'s');
                    if (comments.length) renderCardCommentPreview(wid);
                    if (window._likedPosts.has(String(wid))) {
                        const likeBtn = card.querySelector('.like-btn');
                        if (likeBtn) likeBtn.classList.add('liked');
                    }
                });
            } catch(e) {
                console.warn('Feed error:', e.message);
                feed.innerHTML = '<div style="text-align:center;padding:40px;color:#555;">Could not load feed.</div>';
            }
        }

        // ── GROUPS ────────────────────────────────────────────────────────
        function openGroup(groupId) {
            const groupsGrid   = document.querySelector('.groups-grid');
            const groupsHeader = document.querySelector('.groups-header');
            const groupDetail  = document.getElementById('groupDetail');
            if (groupsGrid)   groupsGrid.style.display   = 'none';
            if (groupsHeader) groupsHeader.style.display = 'none';
            if (groupDetail)  groupDetail.classList.add('active');
        }
        function closeGroup() {
            const groupsGrid   = document.querySelector('.groups-grid');
            const groupsHeader = document.querySelector('.groups-header');
            const groupDetail  = document.getElementById('groupDetail');
            if (groupsGrid)   groupsGrid.style.display   = 'grid';
            if (groupsHeader) groupsHeader.style.display = 'flex';
            if (groupDetail)  groupDetail.classList.remove('active');
        }
        function completeWorkout(button) {
            if (button.classList.contains('completed')) {
                button.classList.remove('completed');
                button.textContent = 'Mark Complete';
            } else {
                button.classList.add('completed');
                button.textContent = 'Completed!';
                setTimeout(() => alert('Great work! Completion posted!'), 300);
            }
        }
        function openCreateGroupModal()  { alert('Create Group - coming soon!'); }
        function openPostWorkoutModal()  { alert('Post Workout Challenge - coming soon!'); }

        // ── AUTH UI ───────────────────────────────────────────────────────
        function showSignup() {
            const sp = document.getElementById('signupPage');
            const lp = document.getElementById('loginPage');
            if (sp) { sp.style.display = 'flex'; sp.classList.add('active'); }
            if (lp) { lp.style.display = 'none';  lp.classList.remove('active'); }
            clearAuthErrors();
        }
        function showLogin() {
            const lp = document.getElementById('loginPage');
            const sp = document.getElementById('signupPage');
            if (lp) { lp.style.display = 'flex'; lp.classList.add('active'); }
            if (sp) { sp.style.display = 'none';  sp.classList.remove('active'); }
            clearAuthErrors();
        }
        function logout() {
            window._ssCurrentUser = null; window._sbToken = null; window._sbUserId = null;
            try { localStorage.removeItem('sb_session'); } catch(e) {}
            showPage('feed'); showSignup();
        }
        function showAuthError(formId, msg) {
            const el = document.getElementById(formId + 'Error');
            if (el) { el.textContent = msg; el.style.display = 'block'; }
        }
        function clearAuthErrors() {
            document.querySelectorAll('.auth-error').forEach(el => { el.textContent=''; el.style.display='none'; });
        }

        // ── PROFILE ───────────────────────────────────────────────────────
        function loadProfileForUser(user) {
            user.fullName = user.full_name || user.fullName || user.username || '';
            user.initials = user.initials || user.fullName.split(' ').map(w=>w[0]||'').join('').toUpperCase().slice(0,2) || '??';
            const el = id => document.getElementById(id);
            if (el('profileName'))     el('profileName').textContent    = user.fullName;
            if (el('profileUsername')) el('profileUsername').textContent = '@' + user.username;
            if (el('profileBio'))      el('profileBio').textContent      = user.bio || 'No bio yet.';
            if (el('profileFollowers')) el('profileFollowers').textContent = user.followers || 0;
            if (el('profileFollowing')) el('profileFollowing').textContent = user.following || 0;
            // Profile avatar
            const avatarEl = document.getElementById('profileInitials');
            if (avatarEl) {
                if (user.avatar_url) {
                    avatarEl.innerHTML = '<img src="' + user.avatar_url + '" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">';
                } else {
                    avatarEl.textContent = user.initials;
                }
            }
            refreshProfileStats(user); refreshProfileWorkouts(user); refreshAchievements(user);
        }

        function switchProfileTab(tabName) {
            document.querySelectorAll('.profile-tab').forEach(t => {
                t.classList.toggle('active', (t.getAttribute('onclick') && t.getAttribute('onclick').includes(tabName)));
            });
            document.querySelectorAll('.profile-tab-content').forEach(c => c.classList.remove('active'));
            const tc = document.getElementById(tabName + '-tab');
            if (tc) tc.classList.add('active');
            const u = getCurrentUser();
            if (!u) return;
            if (tabName === 'stats')        refreshProfileStats(u);
            if (tabName === 'workouts')     refreshProfileWorkouts(u);
            if (tabName === 'achievements') refreshAchievements(u);
        }

        function refreshProfileStats(user) {
            const workouts      = user.workouts || [];
            const totalWorkouts = workouts.length;
            const totalEx       = workouts.reduce((s,w) => s + ((w.exercises ? w.exercises.length : 0)||0), 0);
            const totalMins     = workouts.reduce((s,w) => s + (w.duration||0), 0);
            const set = (id,v) => { const el = document.getElementById(id); if(el) el.textContent=v; };
            set('statTotalWorkouts', totalWorkouts); set('statTotalExercises', totalEx);
            set('statTotalMinutes', totalMins); set('profileWorkoutCount', totalWorkouts);
            const list = document.getElementById('recentWorkoutsList');
            if (!list) return;
            list.innerHTML = workouts.length === 0
                ? '<p style="color:#999;text-align:center;padding:30px;">No workouts logged yet.</p>'
                : '<h3 style="font-family:\'Bebas Neue\',cursive;font-size:22px;letter-spacing:2px;color:var(--primary);margin-bottom:15px;">Recent Workouts</h3>' +
                  workouts.slice(0,10).map(w => {
                    const d = new Date(w.created_at || w.date || Date.now());
                    return '<div style="background:var(--steel);border-left:3px solid var(--primary);padding:15px 20px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;">' +
                        '<div><div style="font-family:\'Bebas Neue\',cursive;font-size:18px;letter-spacing:1px;">' + (w.name||'Untitled').toUpperCase() + '</div>' +
                        '<div style="font-size:12px;color:#999;margin-top:3px;">' + ((w.exercises ? w.exercises.length : 0)||0) + ' exercises &middot; ' + (w.duration||0) + ' min</div></div>' +
                        '<div style="font-size:12px;color:#666;font-family:\'Roboto Mono\',monospace;">' + (isNaN(d)?'Recently':d.toLocaleDateString()) + '</div></div>';
                  }).join('');
        }

        function refreshProfileWorkouts(user) {
            const feed = document.getElementById('profileWorkoutFeed');
            if (!feed) return;
            const workouts = (user.workouts||[]).filter(w => w && w.name);
            if (workouts.length === 0) {
                feed.innerHTML = '<div style="text-align:center;padding:60px 20px;color:#999;">' +
                    '<h3 style="font-family:\'Bebas Neue\',cursive;font-size:28px;color:var(--primary);margin-bottom:10px;">No Workouts Yet</h3>' +
                    '<p>Hit the + button to log your first workout!</p></div>';
                return;
            }
            feed.innerHTML = '';
            workouts.forEach(w => {
                const card = buildWorkoutCardEl(w, user);
                feed.appendChild(card);
            });
        }

        function refreshAchievements(user) {
            const grid = document.getElementById('achievementsGrid');
            if (!grid) return;
            const workouts = (user.workouts||[]).filter(w=>w);
            const count = workouts.length;
            const totalMins = workouts.reduce((s,w)=>s+(w.duration||0),0);
            const exNames = new Set();
            workouts.forEach(w => (w.exercises||[]).forEach(e => { if(e && e.name) exNames.add(e.name.toLowerCase()); }));
            const all = [
                { icon:'&#127949;', title:'First Rep',       desc:'Log your first workout',         earned: count>=1 },
                { icon:'&#128287;', title:'10 Workout Club', desc:'Log 10 workouts',                earned: count>=10 },
                { icon:'&#127942;', title:'25 Workout Club', desc:'Log 25 workouts',                earned: count>=25 },
                { icon:'&#9203;',   title:'Hour Grinder',    desc:'Log 60+ min in one workout',     earned: workouts.some(w=>w.duration>=60) },
                { icon:'&#128336;', title:'Time Warrior',    desc:'Log 1,000 total minutes',        earned: totalMins>=1000 },
                { icon:'&#128170;', title:'Variety Pack',    desc:'Log 5 different exercises',      earned: exNames.size>=5 },
                { icon:'&#128293;', title:'On Fire',         desc:'Log 3 workouts in one week',     earned: hasWorkoutsInWeek(workouts,3) },
                { icon:'&#9889;',   title:'Consistent',      desc:'Log workouts 2 weeks in a row',  earned: hasWeeklyStreak(workouts,2) },
            ];
            const earned = all.filter(a=>a.earned), locked = all.filter(a=>!a.earned);
            let html = '';
            if (!earned.length) html += '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#999;"><h3 style="font-family:\'Bebas Neue\',cursive;font-size:28px;color:var(--primary);margin-bottom:10px;">No Achievements Yet</h3><p>Log workouts to start earning!</p></div>';
            else { html += '<div style="grid-column:1/-1;font-family:\'Bebas Neue\',cursive;font-size:18px;letter-spacing:2px;color:var(--primary);padding:10px 0 5px;">EARNED (' + earned.length + ')</div>'; earned.forEach(a => { html += '<div class="achievement-card" style="border-color:var(--primary);"><div class="achievement-icon">' + a.icon + '</div><div class="achievement-title">' + a.title + '</div><div class="achievement-description">' + a.desc + '</div></div>'; }); }
            if (locked.length) { html += '<div style="grid-column:1/-1;font-family:\'Bebas Neue\',cursive;font-size:18px;letter-spacing:2px;color:#555;padding:20px 0 5px;">LOCKED (' + locked.length + ')</div>'; locked.forEach(a => { html += '<div class="achievement-card" style="opacity:0.35;filter:grayscale(1);"><div class="achievement-icon">&#128274;</div><div class="achievement-title" style="color:#666;">' + a.title + '</div><div class="achievement-description">' + a.desc + '</div></div>'; }); }
            grid.innerHTML = html;
        }

        function hasWorkoutsInWeek(workouts, n) {
            const weeks = {};
            workouts.forEach(w => { const d=new Date(w.created_at||w.date||Date.now()); const k=d.getFullYear()+'-W'+Math.floor((d-new Date(d.getFullYear(),0,1))/604800000); weeks[k]=(weeks[k]||0)+1; });
            return Object.values(weeks).some(v=>v>=n);
        }
        function hasWeeklyStreak(workouts, weeks) {
            if (!workouts.length) return false;
            const wks = Array.from(new Set(workouts.map(function(w){ var d=new Date(w.created_at||w.date||Date.now()); return d.getFullYear()+'-W'+Math.floor((d-new Date(d.getFullYear(),0,1))/604800000); }))).sort();
            let streak=1,best=1;
            for (let i=1;i<wks.length;i++) { const p=wks[i-1].split('-W'),c=wks[i].split('-W'); const diff=(+c[1]-+p[1])+(+c[0]-+p[0])*52; streak=diff===1?streak+1:1; best=Math.max(best,streak); }
            return best>=weeks;
        }

        // ── SIGNUP / LOGIN ────────────────────────────────────────────────
        async function handleSignup() {
            const fullName = document.getElementById('signupName').value.trim();
            const username = document.getElementById('signupUsername').value.trim().toLowerCase();
            const email    = document.getElementById('signupEmail').value.trim().toLowerCase();
            const password = document.getElementById('signupPassword').value;
            if (!fullName||!username||!email||!password) { showAuthError('signup','Please fill in all fields.'); return; }
            if (username.length < 3) { showAuthError('signup','Username must be at least 3 characters.'); return; }
            if (password.length < 6) { showAuthError('signup','Password must be at least 6 characters.'); return; }
            const btn = document.querySelector('#signupForm .auth-submit-btn');
            btn.textContent = 'Creating...'; btn.disabled = true;
            try {
                const taken = await sb('profiles?username=eq.'+username+'&select=id');
                if (taken && taken.length) { showAuthError('signup','Username already taken.'); btn.textContent='Create Account'; btn.disabled=false; return; }
                const authData = await sbAuth('signup', email, password);
                const userId = authData.user && authData.user.id;
                const token  = authData.access_token || authData.session && authData.session.access_token;
                if (!userId) { showAuthError('signup','Check your email to confirm your account, then log in.'); btn.textContent='Create Account'; btn.disabled=false; return; }
                window._sbToken = token; window._sbUserId = userId;
                if (token) saveSession({ access_token: token, user: { id: userId }, expires_at: authData.expires_at||(Date.now()/1000+3600) });
                const initials = fullName.split(' ').map(w=>w[0]||'').join('').toUpperCase().slice(0,2);
                await sb('profiles', { method:'POST', body:{ id:userId, username, full_name:fullName, initials, bio:'', followers:0, following:0 } });
                const profile = { id:userId, username, full_name:fullName, fullName, initials, bio:'', followers:0, following:0, workouts:[] };
                setCurrentUser(profile); loadProfileForUser(profile);
                await loadFeedFromSupabase(); navigateToFeed();
            } catch(err) { showAuthError('signup', err.message); btn.textContent='Create Account'; btn.disabled=false; }
        }

        async function handleLogin() {
            const email    = document.getElementById('loginIdentifier').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            if (!email||!password) { showAuthError('login','Please fill in all fields.'); return; }
            const btn = document.querySelector('#loginForm .auth-submit-btn');
            btn.textContent = 'Logging in...'; btn.disabled = true;
            try {
                const authData = await sbAuth('token?grant_type=password', email, password);
                window._sbToken = authData.access_token; window._sbUserId = authData.user.id;
                saveSession(authData);
                let profiles = await sb('profiles?id=eq.'+authData.user.id+'&select=*');
                let profile  = (profiles && profiles[0]);
                if (!profile) {
                    profile = { id:authData.user.id, username:email.split('@')[0], full_name:email.split('@')[0], initials:email.slice(0,2).toUpperCase(), bio:'', followers:0, following:0 };
                    await sb('profiles', { method:'POST', body:profile });
                }
                const workouts = await sb('workouts?user_id=eq.'+authData.user.id+'&order=created_at.desc&select=*');
                profile.workouts = workouts || [];
                
                // Load follows from Supabase
                const follows = await sb('follows?follower_id=eq.'+authData.user.id+'&select=following_id');
                window._following = new Set((follows || []).map(f => String(f.following_id)));
                
                setCurrentUser(profile); loadProfileForUser(profile);
                await loadFeedFromSupabase(); navigateToFeed();
            } catch(err) { showAuthError('login', err.message.includes('Invalid')?'Incorrect email or password.':err.message); btn.textContent='Log In'; btn.disabled=false; }
        }

        // ── FOLLOW SYSTEM ─────────────────────────────────────────────────
        function isFollowing(uid) { return window._following.has(String(uid)); }
        async function toggleFollow(uid, btn) {
            if (!getCurrentUser()) { alert('Please log in to follow people.'); return; }
            uid = String(uid);
            if (isFollowing(uid)) {
                window._following.delete(uid); btn.textContent='Follow'; btn.classList.remove('following');
                try { 
                    await sb('follows?follower_id=eq.'+window._sbUserId+'&following_id=eq.'+uid, {method:'DELETE',prefer:''}); 
                    // Update local count
                    const user = getCurrentUser();
                    if (user) { user.following = Math.max(0, (user.following || 0) - 1); setCurrentUser(user); refreshProfileStats(user); }
                } catch(e) { console.warn('Unfollow failed:', e); }
            } else {
                window._following.add(uid); btn.textContent='Following'; btn.classList.add('following');
                try { 
                    await sb('follows', {method:'POST', body:{follower_id:window._sbUserId, following_id:uid}}); 
                    // Update local count
                    const user = getCurrentUser();
                    if (user) { user.following = (user.following || 0) + 1; setCurrentUser(user); refreshProfileStats(user); }
                } catch(e) { console.warn('Follow failed:', e); }
            }
            saveFollowing();
        }

        // ── SEARCH ────────────────────────────────────────────────────────
        let _allProfiles = [];
        async function loadPeopleFeed() {
            try {
                const profiles = await sb('profiles?select=id,username,full_name,initials,bio,followers,following,avatar_url&limit=50');
                const me = getCurrentUser();
                _allProfiles = (profiles||[]).filter(p => !me || p.id !== me.id);
                renderPeopleResults(_allProfiles, '');
            } catch(e) { renderPeopleResults([], ''); }
        }
        function handlePeopleSearch(q) {
            q = q.trim().toLowerCase();
            renderPeopleResults(!q ? _allProfiles : _allProfiles.filter(p =>
                (p.full_name||'').toLowerCase().includes(q) || (p.username||'').toLowerCase().includes(q)), q);
        }
        function renderPeopleResults(people, query) {
            const grid  = document.getElementById('peopleGrid');
            const title = document.getElementById('searchResultsTitle');
            const empty = document.getElementById('searchEmpty');
            if (!grid) return;
            if (title) title.textContent = query ? 'Results for "'+query+'"' : 'All Athletes';
            if (!people.length) { grid.innerHTML=''; if(empty) empty.style.display='block'; return; }
            if (empty) empty.style.display='none';
            grid.innerHTML = people.map(p => {
                const name = p.full_name||p.username||'Unknown';
                const init = p.initials||name.split(' ').map(x=>x[0]||'').join('').toUpperCase().slice(0,2);
                const following = isFollowing(p.id);
                const av = p.avatar_url ? '<img src="'+p.avatar_url+'" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">' : init;
                return '<div class="person-card"><div class="person-avatar">'+av+'</div>' +
                    '<div class="person-info"><div class="person-name">'+name+'</div><div class="person-username">@'+(p.username||'?')+'</div><div class="person-bio">'+(p.bio||'No bio yet')+'</div></div>' +
                    '<div class="person-stats"><div class="person-stat"><div class="person-stat-num">'+(p.followers||0)+'</div><div class="person-stat-lbl">Followers</div></div>' +
                    '<div class="person-stat"><div class="person-stat-num">'+(p.following||0)+'</div><div class="person-stat-lbl">Following</div></div></div>' +
                    '<button class="follow-btn '+(following?'following':'')+'" onclick="event.stopPropagation();toggleFollow(\''+p.id+'\',this)">'+(following?'Following':'Follow')+'</button></div>';
            }).join('');
        }

        // ── PROGRESS ──────────────────────────────────────────────────────
        function renderProgressPage() {
            const user = getCurrentUser();
            const workouts = user ? (user.workouts||[]) : [];
            const exMap = {};
            workouts.forEach(w => {
                const date = w.created_at||w.date||new Date().toISOString();
                (w.exercises||[]).forEach(ex => {
                    if (!(ex && ex.name)||!ex.weight) return;
                    const key = ex.name.trim().toLowerCase();
                    if (!exMap[key]) exMap[key] = { displayName: ex.name.trim(), entries: [] };
                    exMap[key].entries.push({ date, weight: parseFloat(ex.weight) });
                });
            });
            Object.values(exMap).forEach(e => e.entries.sort((a,b)=>new Date(a.date)-new Date(b.date)));
            window._exerciseMap = exMap;
            const keys = Object.keys(exMap);
            const selector = document.querySelector('.exercise-selector');
            if (selector) {
                selector.innerHTML = keys.length === 0
                    ? '<div style="color:#555;font-size:14px;padding:20px;text-align:center;grid-column:1/-1;">Log workouts with weights to see progress here.</div>'
                    : keys.map((key,i) => '<button class="exercise-btn'+(i===0?' active':'')+'" onclick="selectProgressExercise(\''+key+'\',this)">'+exMap[key].displayName+'</button>').join('');
            }
            if (keys.length > 0) renderProgressExercise(keys[0], exMap[keys[0]]);
            renderHistoryTable(workouts);
        }

        function selectProgressExercise(key, btn) {
            document.querySelectorAll('.exercise-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            if (window._exerciseMap && window._exerciseMap[key]) renderProgressExercise(key, window._exerciseMap[key]);
        }

        function renderProgressExercise(key, exData) {
            const entries = exData.entries, weights = entries.map(e=>e.weight);
            const pr = Math.max.apply(null, weights), increase = pr-(weights[0]||0);
            const titleEl = document.getElementById('chartTitle');
            if (titleEl) titleEl.innerHTML = exData.displayName+' Progress <span class="pr-badge">PR: '+pr+' LBS</span>';
            const set = (id,v)=>{ const el=document.getElementById(id); if(el) el.textContent=v; };
            set('currentPR', pr+' lbs'); set('totalIncrease', (increase>=0?'+':'')+increase+' lbs'); set('avgGain', entries.length+' sessions');
            const labels = entries.map(e=>{ const d=new Date(e.date); return d.toLocaleDateString('en-US',{month:'short',day:'numeric'}); });
            if (window.progressChart) { window.progressChart.data.labels=labels; window.progressChart.data.datasets[0].data=weights; window.progressChart.update(); }
            else {
                const canvas = document.getElementById('progressChart');
                if (canvas) window.progressChart = new Chart(canvas.getContext('2d'),{type:'line',data:{labels,datasets:[{label:'Weight (lbs)',data:weights,borderColor:'#ff6b35',backgroundColor:'rgba(255,107,53,0.2)',borderWidth:4,fill:true,tension:0.4,pointRadius:7,pointBackgroundColor:'#ff6b35',pointBorderColor:'#fff',pointBorderWidth:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{backgroundColor:'#2a2a2a',titleColor:'#ff6b35',bodyColor:'#fff',borderColor:'#ff6b35',borderWidth:2,padding:15,displayColors:false,callbacks:{label:c=>c.parsed.y+' lbs'}}},scales:{y:{beginAtZero:false,grid:{color:'rgba(255,255,255,0.08)'},ticks:{color:'#999',font:{family:'Roboto Mono',size:13},callback:v=>v+' lbs'}},x:{grid:{color:'rgba(255,255,255,0.08)'},ticks:{color:'#999',font:{family:'Roboto Mono',size:13}}}}}});
            }
        }

        function renderHistoryTable(workouts) {
            const tbody = document.getElementById('historyTableBody');
            if (!tbody) return;
            const rows = [];
            workouts.forEach(w => {
                const date = w.created_at||w.date;
                (w.exercises||[]).forEach(ex => { if((ex && ex.name)) rows.push({date:new Date(date||Date.now()),name:ex.name,weight:ex.weight?parseFloat(ex.weight):null,sets:ex.sets,reps:ex.reps}); });
            });
            rows.sort((a,b)=>b.date-a.date);
            if (!rows.length) { tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:#555;padding:30px;">No history yet.</td></tr>'; return; }
            const lastWeight = {};
            tbody.innerHTML = rows.slice(0,20).map(row => {
                const key=row.name.toLowerCase(), prev=lastWeight[key];
                let trend='&mdash;';
                if (row.weight&&prev!==undefined) { const diff=row.weight-prev; trend=diff>0?'<span class="trend-up">+'+diff+' lbs</span>':diff<0?'<span class="trend-down">'+diff+' lbs</span>':'<span class="trend-neutral">&mdash;</span>'; }
                lastWeight[key]=row.weight;
                const vol=(row.sets&&row.reps&&row.weight)?(+row.sets * +row.reps * row.weight).toLocaleString()+' lbs':'&mdash;';
                return '<tr><td>'+row.date.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})+'</td><td>'+row.name+'</td><td>'+(row.weight?row.weight+' lbs':'&mdash;')+'</td><td>'+(row.sets||'&mdash;')+' x '+(row.reps||'&mdash;')+'</td><td>'+vol+'</td><td>'+trend+'</td></tr>';
            }).join('');
        }

        // ── INIT ──────────────────────────────────────────────────────────
        (async function init() {
            loadFeedFromSupabase();
            try {
                const stored = localStorage.getItem('sb_session');
                if (stored) {
                    const sess = JSON.parse(stored);
                    if (sess.expires_at > Date.now()/1000) {
                        window._sbToken = sess.access_token; window._sbUserId = sess.user_id;
                        const profiles = await sb('profiles?id=eq.'+sess.user_id+'&select=*');
                        if ((profiles && profiles[0])) {
                            const workouts = await sb('workouts?user_id=eq.'+sess.user_id+'&order=created_at.desc&select=*');
                            profiles[0].workouts = workouts||[];
                            
                            // Load follows from Supabase
                            const follows = await sb('follows?follower_id=eq.'+sess.user_id+'&select=following_id');
                            window._following = new Set((follows || []).map(f => String(f.following_id)));
                            
                            setCurrentUser(profiles[0]); loadProfileForUser(profiles[0]);
                            navigateToFeed(); return;
                        }
                    }
                }
            } catch(e) { console.warn('Session restore failed:', e.message); }
            showSignup();
        })();

        // ── EXPOSE FUNCTIONS GLOBALLY FOR INLINE ONCLICK ─────────────────
        window.openModal = function() { document.getElementById('postTypeOverlay').classList.add('active'); };
        window.closePostType = function() { document.getElementById('postTypeOverlay').classList.remove('active'); };
        window.openWorkoutModal = function(type) {
            window._postType = type;
            window.closePostType();
            document.getElementById('modalTitle').textContent = type === 'group' ? 'Post to Group' : 'Log Workout';
            document.getElementById('groupSelectWrap').style.display = type === 'group' ? 'block' : 'none';
            window.goToStep1();
            document.getElementById('workoutModal').classList.add('active');
        };
        window.closeModal = function() { document.getElementById('workoutModal').classList.remove('active'); };
        window.goToStep1 = function() {
            document.getElementById('modalStep1').classList.add('active');
            document.getElementById('modalStep2').classList.remove('active');
            document.getElementById('dot1').classList.add('active');
            document.getElementById('dot2').classList.remove('active');
        };
        window.goToStep2 = function() {
            const name = document.getElementById('workoutName').value.trim();
            if (!name) { alert('Please enter a workout name.'); return; }
            document.getElementById('modalStep1').classList.remove('active');
            document.getElementById('modalStep2').classList.add('active');
            document.getElementById('dot1').classList.remove('active');
            document.getElementById('dot2').classList.add('active');
        };
        window.addExercise = function() {
            const container = document.getElementById('exerciseContainer');
            const div = document.createElement('div');
            div.className = 'exercise-inputs';
            div.innerHTML = '<input type="text" placeholder="Exercise name"><input type="number" placeholder="Sets"><input type="number" placeholder="Reps"><input type="number" placeholder="Weight (lbs)">';
            container.appendChild(div);
        };
        window.removeWorkoutPhoto = function() {
            document.getElementById('photoInput').value = '';
            const img = document.getElementById('previewImage');
            const zone = document.getElementById('photoZone');
            img.classList.remove('active');
            zone.classList.remove('has-image');
            document.getElementById('removePhoto').classList.remove('active');
            zone.querySelector('.upload-icon').style.display = 'block';
            zone.querySelector('.upload-text').style.display = 'block';
        };
        window.handleLogWorkout = handleLogWorkout;
        window.toggleDetails = function(button) {
            button.classList.toggle('active');
            const icon = button.querySelector('.details-toggle-icon');
            const content = button.nextElementSibling;
            if (icon) icon.style.transform = button.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0)';
            if (content) content.classList.toggle('active');
        };
        window.handleLike = function(btn) {
            const wid = btn.dataset.wid;
            if (window._likedPosts && window._likedPosts.has(String(wid))) return;
            if (window._likedPosts) window._likedPosts.add(String(wid));
            if (window.saveLikes) window.saveLikes();
            btn.classList.add('liked');
            const countEl = btn.querySelector('.like-count');
            const cur = parseInt(countEl.textContent) || 0;
            countEl.textContent = (cur + 1) + ' Like' + (cur + 1 === 1 ? '' : 's');
        };
        window.openWorkoutDrawer = openWorkoutDrawer;
        window.closeDrawer = function() {
            document.getElementById('workoutDrawer').classList.remove('active');
            window._activeDrawerWorkout = null;
        };
        window.submitComment = submitComment;
        window.openGroup = function(groupId) {
            const groupsGrid = document.querySelector('.groups-grid');
            const groupsHeader = document.querySelector('.groups-header');
            const groupDetail = document.getElementById('groupDetail');
            if (groupsGrid) groupsGrid.style.display = 'none';
            if (groupsHeader) groupsHeader.style.display = 'none';
            if (groupDetail) groupDetail.classList.add('active');
        };
        window.closeGroup = function() {
            const groupsGrid = document.querySelector('.groups-grid');
            const groupsHeader = document.querySelector('.groups-header');
            const groupDetail = document.getElementById('groupDetail');
            if (groupsGrid) groupsGrid.style.display = 'grid';
            if (groupsHeader) groupsHeader.style.display = 'flex';
            if (groupDetail) groupDetail.classList.remove('active');
        };
        window.completeWorkout = function(button) {
            if (button.classList.contains('completed')) {
                button.classList.remove('completed');
                button.textContent = 'Mark Complete';
            } else {
                button.classList.add('completed');
                button.textContent = 'Completed!';
                setTimeout(() => alert('Great work!'), 300);
            }
        };
        window.openCreateGroupModal = function() { alert('Create Group - coming soon!'); };
        window.openPostWorkoutModal = function() { alert('Post Workout Challenge - coming soon!'); };
        window.logout = function() {
            window._ssCurrentUser = null;
            window._sbToken = null;
            window._sbUserId = null;
            try { localStorage.removeItem('sb_session'); } catch (e) {}
            location.reload();
        };
        window.switchProfileTab = function(tabName) {
            document.querySelectorAll('.profile-tab').forEach(t => {
                t.classList.toggle('active', t.getAttribute('onclick') && t.getAttribute('onclick').includes(tabName));
            });
            document.querySelectorAll('.profile-tab-content').forEach(c => c.classList.remove('active'));
            const tc = document.getElementById(tabName + '-tab');
            if (tc) tc.classList.add('active');
        };
        window.navigateToPage = navigateToPage;
        window.selectProgressExercise = selectProgressExercise;
        window.toggleFollow = toggleFollow;
        window.handleSignup = handleSignup;
        window.handleLogin = handleLogin;
        window.showSignup = function() {
            const sp = document.getElementById('signupPage');
            const lp = document.getElementById('loginPage');
            if (sp) { sp.style.display = 'flex'; sp.classList.add('active'); }
            if (lp) { lp.style.display = 'none'; lp.classList.remove('active'); }
        };
        window.showLogin = function() {
            const lp = document.getElementById('loginPage');
            const sp = document.getElementById('signupPage');
            if (lp) { lp.style.display = 'flex'; lp.classList.add('active'); }
            if (sp) { sp.style.display = 'none'; sp.classList.remove('active'); }
        };

    </script>


</body>
</html>
